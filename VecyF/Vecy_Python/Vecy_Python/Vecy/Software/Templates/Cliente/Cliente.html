{% extends 'base.html' %}
{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="{% static 'css/principal.css' %}" />
    <link rel="stylesheet" href="{% static 'css/index.css' %}" />
    <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <title>Principal</title>
</head>

<body>
    {% block content %}
    <div class="containerv">
        <img class="img_fondo" src="{% static 'img/iglesia.jpg'%}" alt="" />
        <div class="contenido"></div>
        <div class="header">
            <div class="logo"><span>VECY</span></div>
            <div class="menu-desplegable">
                <span style="font-weight: bold;" data-bs-toggle="offcanvas" data-bs-target="#menuLateral">
                    <i class="fas fa-bars iconm"></i> Men√∫
                </span>
            </div>
            <div class="input-group1">
                <form method="get" action="{% url 'cliente_dash' %}">
                    <input class="input" type="search" name="q" placeholder="Busca negocios, productos..."
                        value="{{ query }}">
                    <button type="submit"><i class="fas fa-search iconl"></i></button>
                </form>
            </div>
            <div class="iniSesion">
                <i class="fas fa-truck"></i>
                <a href="" id="it2">Pedidos</a>
            </div>
            <div class="iniSesion">
                <i class="fas fa-cart-shopping"></i>
                <a href="{% url 'ver_carrito' %}">Carrito</a>
            </div>
            <div class="iniSesion">
                <i class="fas fa-heart"></i>
                <a href="">Favoritos</a>
            </div>
            <div class="iniSesion">
                <i class="fas fa-user-circle"></i>
                <a href="{% url 'cerrar_sesion' %}">Salir</a>
            </div>
        </div>
        <!--Menu lateral-->
        <div class="offcanvas offcanvas-start" tabindex="-1" id="menuLateral" aria-labelledby="menuLateralLabel">
            <div class="offcanvas-header headerM">
                <h5 class="offcanvas-title" id="menuLateralLabel">VECY</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"
                    aria-label="Cerrar"></button>
            </div>
            <div class="offcanvas-body bodyM">
                <ul class="list-unstyled">
                    <span class="cat mb-5">Categor√≠as</span>
                    <br>
                    {% for categoria in categorias %}
                    <li><a href="#" class="d-block categorias">{{ categoria.desc_cp }}</a></li>
                    {% empty %}
                    <li><span class="text-white-50">No hay categor√≠as disponibles</span></li>
                    {% endfor %}

                </ul>
            </div>
        </div>

        <div class="men_ini">
            <h1>Te damos la Bienvenida</h1>
            <p>Encuentra los negocios y productos cerca de ti.</p>
            <button class="info btn1">Ver Negocios</button>
            <button class="info btn2" onclick="location.href='#negocios'">Ver Categor√≠as</button>
        </div>
    </div>
    <div class="anuncio">
        <marquee behavior="scroll" direction="left">
            üôÇ Encuentra todo lo que necesites a un clic.
        </marquee>
    </div>

    <div class="main" id="negocios">
        <div class="categoriaNeg">
            <h4>Categor√≠as Que Te Pueden Interesar</h4>
            <div class="rowP" data-aos="fade-up">
                {% for categoria in categorias_interes %}
                <div class="cardC">
    <a href="{% url 'cliente_dash' %}?categoria={{ categoria.pkid_cp }}">
        {% if categoria.desc_cp|lower == "helado" %}
        <img src="{% static 'img/helader√≠a.jpg' %}" alt="">
        {% elif categoria.desc_cp|lower == "abarrotes" %}
        <img src="{% static 'img/abarrotes.jpg' %}" alt="">
        {% elif categoria.desc_cp == "Bebidas gaseosas" %}
        <img src="{% static 'img/bebidas.jpg' %}" alt="">
        {% elif categoria.desc_cp == "Jugos naturales" %}
        <img src="{% static 'img/bebidasN.jpg' %}" alt="">
        {% elif categoria.desc_cp == "Agua embotellada" %}
        <img src="{% static 'img/agua.jpg' %}" alt="">
        {% elif categoria.desc_cp|lower == "l√°cteos" %}
        <img src="{% static 'img/lacteos.jpg' %}" alt="">
        {% elif categoria.desc_cp == "Carnes fr√≠as y embutidos" %}
        <img src="{% static 'img/carnes.jpg' %}" alt="">
        {% elif categoria.desc_cp == "Celulares y accesorios" %}
        <img src="{% static 'img/celular.jpg' %}" alt="">
        {% elif categoria.desc_cp == "Verduras frescas" %}
        <img src="{% static 'img/verduras.jpg' %}" alt="">
        {% elif categoria.desc_cp == "Frutas frescas" %}
        <img src="{% static 'img/frutas.jpg' %}" alt="">
        {% elif categoria.desc_cp == "Panader√≠a" %}
        <img src="{% static 'img/panes.jpg' %}" alt="">
        {% elif categoria.desc_cp == "Reposter√≠a" %}
        <img src="{% static 'img/reposteria.jpg' %}" alt="">
        {% endif %}
        <h6 class="mt-3">{{ categoria.desc_cp }}</h6>
    </a>
</div>

                {% endfor %}
            </div>
        </div>
        <div class="negs">
            <h4>Negocios Mejor Calificados</h4>
            <p>Encuentra los negocios cerca de ti.</p>
        </div>
        <div class="rowNegs">
            {% for negocio in negocios_mejor_calificados %}
            <div class="cardN">
                {% if negocio.img_neg %}
                <img src="{{ negocio.img_neg.url }}" alt="{{ negocio.nom_neg }}">
                {% else %}
                <img src="{% static 'img/default_negocio.jpg' %}" alt="{{ negocio.nom_neg }}">
                {% endif %}
                <div class="cardN-body">
                    <h6 class="mt-3">{{ negocio.nom_neg }}</h6>
                    <p>{{ negocio.desc_neg }}</p>
                    <div><i class="fas fa-map-marker-alt iconmap"></i> {{ negocio.direcc_neg }}</div>
                    <span><strong>Tipo Negocio:</strong> {{ negocio.fktiponeg_neg.desc_tiponeg }}</span>
                    <div class="verP">
                        <a href="{% url 'detalle_negocio' negocio.pkid_neg %}" type="button">Ver Productos</a>
                    </div>
                    <div class="calificacion">
                        <p>‚≠ê {{ negocio.promedio|floatformat:1 }}</p>
                    </div>
                </div>
            </div>
            {% empty %}
            <p>No hay negocios calificados a√∫n.</p>
            {% endfor %}
        </div>
    </div>
    <div class="rowNegs mt-5" id="resultadosBusqueda">
        {% if query %}
        <div class="rowNegs" id="resultadosBusquedaInner">
            {% for negocio in negocios %}
            <div class="cardN">
                {% if negocio.img_neg %}
                <img src="{{ negocio.img_neg.url }}" alt="{{ negocio.nom_neg }}">
                {% else %}
                <img src="{% static 'img/default_negocio.jpg' %}" alt="{{ negocio.nom_neg }}">
                {% endif %}
                <div class="cardN-body">
                    <h6>{{ negocio.nom_neg }}</h6>
                    <p>{{ negocio.desc_neg }}</p>
                    <span>{{ negocio.direcc_neg }}</span>
                </div>
            </div>
            {% endfor %}
            {% if productos_filtrados %}
            <div class="prods" style="width: 100%; text-align: center;">
                <h4>Productos Encontrados</h4>
            </div>
            <div class="rowNegs mt-3" id="resultadosProductosInner">
                {% for producto in productos_filtrados %}
                <div class="cardN {% if producto.stock_prod == 0 %}sin-stock{% endif %}">
                    {% if producto.img_prod %}
                    <img src="{{ producto.img_prod.url }}" class="card-img-top" alt="{{ producto.nom_prod }}">
                    {% else %}
                    <img src="{% static 'img/default_producto.jpg' %}" class="card-img-top"
                        alt="{{ producto.nom_prod }}">
                    {% endif %}
                    <div class="cardN-body">
                        <h6>{{ producto.nom_prod }}</h6>
                        <p>{{ producto.desc_prod }}</p>
                        <span><strong>Precio:</strong> ${{ producto.precio_prod }}</span><br>
                        <span><strong>Cantidad Disponible:</strong> {{ producto.stock_prod }}</span><br>

                        {% if producto.stock_prod == 0 %}
                        <span class="text-danger fw-bold">¬°Producto agotado!</span>
                        {% else %}
                        <div class="solicitar d-flex align-items-center gap-2 mt-2">
                            <button class="btn-minus btn btn-sm btn-outline-secondary">-</button>
                            <input type="number" class="cantidad-prod form-control form-control-sm" value="1" min="1"
                                max="{{ producto.stock_prod }}" style="width:50px;">
                            <button class="btn-plus btn btn-sm btn-outline-secondary">+</button>
                            <button class="btn btn-sm btn-success agregar-carrito" style="height: 8vh !important;"
                                data-prod="{{ producto.pkid_prod }}" data-stock="{{ producto.stock_prod }}">
                                <i class="fas fa-cart-plus"></i> A√±adir
                            </button>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% empty %}
                <p>No hay productos encontrados.</p>
                {% endfor %}
            </div>
            {% endif %}



        </div>

        {% if not negocios and not productos_filtrados %}
        <p>No se encontraron resultados.</p>
        {% endif %}
        {% endif %}
    </div>

    {% endblock %}
    <footer class="footer">
        <div class="footer-section">
            <h3>Vecy Software</h3>
            <p>Conectamos negocios con clientes para que siempre encuentres lo que necesitas.</p>
        </div>

        <div class="footer-section">
            <h3>Enlaces</h3>
            <ul>
                <li><a href="#">Inicio</a></li>
                <li><a href="#">Tiendas</a></li>
                <li><a href="#">Productos</a></li>
                <li><a href="#">Sobre Nosotros</a></li>
            </ul>
        </div>

        <div class="footer-section">
            <h3>Contacto</h3>
            <ul>
                <li>Bogot√°, Colombia</li>
                <li><a href="#">moderador@vecy.com</a></li>
            </ul>
        </div>

        <div class="footer-section redes">
            <h3>S√≠guenos</h3>
            <div class="social-icons">
                <a href="#"><i class="fab fa-facebook-f"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-linkedin-in"></i></a>
            </div>
        </div>
    </footer>

    <div class="footer-bottom">
        ¬© 2025 Vecy Software. Todos los derechos reservados.
    </div>


    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
    <script>
        AOS.init({
            duration: 1000,
            mirror: true,
            once: false
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            {% if query %}
            const resultadosProductos = document.getElementById('resultadosProductosInner');
            const resultadosNegocios = document.getElementById('resultadosBusquedaInner');

            if (resultadosProductos) {
                resultadosProductos.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else if (resultadosNegocios) {
                resultadosNegocios.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            {% endif %}
        });
    </script>


</body>

</html>