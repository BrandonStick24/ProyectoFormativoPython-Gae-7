{% extends 'base.html' %}
{% load static %}
{% block title %}VECY - Tu Mercado Local Digital{% endblock %}

{% block extra_css %}
<!-- AOS ANIMATION -->
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<!-- FONT AWESOME -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="{% static 'cliente/css/cliente.css' %}">
<style>
    /* ===== ESTILOS PARA VARIANTES INDIVIDUALES ===== */
    .vecy-variant-item {
        margin-bottom: 15px;
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        padding: 15px;
        transition: all 0.3s ease;
    }
    
    .vecy-variant-item:hover {
        border-color: #3598db;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .vecy-variant-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }
    
    .vecy-variant-name {
        font-weight: 600;
        color: #333;
        font-size: 1.1rem;
    }
    
    .vecy-variant-price {
        font-weight: 700;
        color: #3598db;
        font-size: 1.2rem;
    }
    
    .vecy-variant-info {
        display: flex;
        gap: 15px;
        margin-bottom: 10px;
    }
    
    .vecy-variant-stock {
        display: flex;
        align-items: center;
        gap: 5px;
        color: #666;
    }
    
    .vecy-variant-stock.in-stock {
        color: #28a745;
    }
    
    .vecy-variant-stock.low-stock {
        color: #ffc107;
    }
    
    .vecy-variant-stock.out-stock {
        color: #dc3545;
    }
    
    .vecy-variant-actions {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }
    
    /* Modificar tarjetas de producto para variantes individuales */
    .vecy-product-card.variant-card {
        position: relative;
        cursor: pointer;
    }
    
    .vecy-variant-badge {
        position: absolute;
        top: 10px;
        left: 10px;
        background: linear-gradient(135deg, #8b5cf6, #a855f7);
        color: white;
        padding: 3px 10px;
        border-radius: 15px;
        font-size: 0.7rem;
        font-weight: 600;
        z-index: 10;
    }
    
    /* ===== NUEVO GRADIENTE PARA TECNOLOGÍA - COLOR TECNOLÓGICO MODERNO ===== */
    .vecy-technology-section {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
        color: white;
        position: relative;
        overflow: hidden;
        padding: 4rem 0 !important;
    }
    
    .vecy-technology-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(circle at 10% 20%, rgba(59, 130, 246, 0.15) 0%, transparent 40%),
            radial-gradient(circle at 90% 80%, rgba(139, 92, 246, 0.15) 0%, transparent 40%),
            radial-gradient(circle at 50% 50%, rgba(6, 182, 212, 0.1) 0%, transparent 60%);
    }
    
    .vecy-technology-section .vecy-section-title {
        background: linear-gradient(135deg, #60a5fa, #38bdf8);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: 0 2px 10px rgba(96, 165, 250, 0.3);
    }
    
    .vecy-technology-section .vecy-section-subtitle {
        color: rgba(203, 213, 225, 0.9);
    }
    
    .vecy-technology-section .vecy-view-all {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border-color: rgba(59, 130, 246, 0.3);
        backdrop-filter: blur(10px);
    }
    
    .vecy-technology-section .vecy-view-all:hover {
        background: #3b82f6;
        color: white;
        transform: translateX(8px);
    }
    
    /* ===== CARRUSEL ESPECIAL PARA TECNOLOGÍA ===== */
    .vecy-tech-carousel-container {
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        margin-bottom: 3rem;
        position: relative;
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(30, 41, 59, 0.8));
        border: 1px solid rgba(59, 130, 246, 0.2);
    }
    
    .vecy-tech-carousel {
        border-radius: 20px;
        min-height: 420px;
        background: transparent;
        padding: 25px;
    }
    
    .vecy-tech-slide {
        position: relative;
        min-height: 420px;
        border-radius: 20px;
        overflow: hidden;
    }
    
    .vecy-tech-background {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }
    
    .vecy-tech-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        filter: brightness(0.4) saturate(1.2);
        animation: techPulse 20s infinite alternate;
    }
    
    @keyframes techPulse {
        0% {
            transform: scale(1);
        }
        100% {
            transform: scale(1.05);
        }
    }
    
    .vecy-tech-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, rgba(15, 23, 42, 0.92) 0%, rgba(30, 41, 59, 0.75) 100%);
    }
    
    .vecy-tech-content {
        position: relative;
        z-index: 2;
        padding: 2.5rem 2rem !important;
        color: white;
        height: 420px;
        display: flex;
        align-items: center;
    }
    
    .vecy-tech-badges {
        margin-bottom: 1.2rem;
    }
    
    .vecy-tech-badge {
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 25px;
        font-size: 0.8rem;
        font-weight: 600;
        margin-right: 0.5rem;
        display: inline-block;
        box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
    }
    
    .vecy-tech-offer {
        background: rgba(255, 255, 255, 0.15);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 25px;
        font-size: 0.8rem;
        font-weight: 600;
        margin-right: 0.5rem;
        display: inline-block;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .vecy-tech-title {
        font-size: 2rem;
        font-weight: 800;
        margin-bottom: 0.8rem;
        color: white;
        text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
        background: linear-gradient(135deg, #fff, #60a5fa);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        line-height: 1.2;
    }
    
    .vecy-tech-description {
        font-size: 1rem;
        margin-bottom: 1.2rem;
        color: #e2e8f0;
        opacity: 0.9;
        line-height: 1.5;
        max-height: 4.5em;
        overflow: hidden;
    }
    
    .vecy-tech-price {
        margin-bottom: 1.5rem;
    }
    
    .vecy-price-display.tech {
        display: flex;
        align-items: center;
        gap: 1.2rem;
        margin-bottom: 0.6rem;
        flex-wrap: wrap;
    }
    
    .vecy-final-price.tech {
        font-size: 1.8rem;
        font-weight: 800;
        color: #60a5fa;
        text-shadow: 0 2px 8px rgba(96, 165, 250, 0.4);
    }
    
    .vecy-original-price.tech {
        font-size: 1.1rem;
        text-decoration: line-through;
        color: #94a3b8;
    }
    
    .vecy-discount-badge.tech {
        background: linear-gradient(135deg, #8b5cf6, #a855f7);
        color: white;
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
    }
    
    .vecy-tech-savings {
        font-size: 0.9rem;
        color: #60a5fa;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .vecy-tech-info {
        display: flex;
        gap: 1.5rem;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
    }
    
    .vecy-info-item.tech {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
        color: #cbd5e1;
    }
    
    .vecy-info-item.tech i {
        color: #60a5fa;
        font-size: 0.9rem;
    }
    
    .vecy-tech-actions {
        display: flex;
        gap: 0.8rem;
        flex-wrap: wrap;
        margin-top: auto;
        padding-top: 1rem;
    }
    
    .vecy-tech-btn {
        padding: 0.75rem 1.5rem !important;
        border: none;
        border-radius: 25px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        transition: all 0.3s ease;
        cursor: pointer;
        font-size: 0.9rem;
        position: relative;
        overflow: hidden;
        min-height: 44px;
    }
    
    .vecy-tech-btn.primary {
        background: linear-gradient(135deg, #3b82f6, #60a5fa);
        color: white;
        box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
    }
    
    .vecy-tech-btn.primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 30px rgba(59, 130, 246, 0.4);
    }
    
    .vecy-tech-btn.secondary {
        background: rgba(255, 255, 255, 0.15);
        color: white;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .vecy-tech-btn.secondary:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateY(-3px);
    }
    
    .vecy-tech-product-image {
        text-align: center;
        position: relative;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1rem;
    }
    
    .tech-product-img {
        max-height: 280px;
        width: auto;
        max-width: 100%;
        border-radius: 15px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        transition: transform 0.5s ease;
    }
    
    .vecy-tech-slide:hover .tech-product-img {
        transform: scale(1.05);
    }
    
    .vecy-tech-placeholder {
        width: 220px;
        height: 220px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        color: #60a5fa;
        margin: 0 auto;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }
    
    /* Controles del carrusel tecnológico */
    .vecy-tech-control {
        width: 50px;
        height: 50px;
        background: rgba(255, 255, 255, 0.15);
        border-radius: 50%;
        top: 50%;
        transform: translateY(-50%);
        margin: 0 1rem;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
    }
    
    .vecy-tech-control:hover {
        background: rgba(59, 130, 246, 0.3);
        transform: translateY(-50%) scale(1.1);
    }
    
    .carousel-control-prev-icon.tech,
    .carousel-control-next-icon.tech {
        background-size: 1rem 1rem;
        filter: invert(1);
    }
    
    .tech-indicators {
        bottom: 20px;
    }
    
    .tech-indicators button {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin: 0 5px;
        background: rgba(255, 255, 255, 0.5);
        border: none;
        transition: all 0.3s ease;
    }
    
    .tech-indicators button.active {
        background: #3b82f6;
        transform: scale(1.2);
    }
    
    /* ====== SECCIÓN DE COMBOS ESPECTACULAR - MEJORADA ====== */
    .vecy-combos-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        position: relative;
        overflow: hidden;
        padding: 3rem 0 !important;
    }
    
    .vecy-combos-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.08) 0%, transparent 50%),
            radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.05) 0%, transparent 70%);
    }
    
    .vecy-combos-section .vecy-section-title {
        color: white;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        font-size: 2.2rem;
        margin-bottom: 0.5rem;
    }
    
    .vecy-combos-section .vecy-section-subtitle {
        color: rgba(255, 255, 255, 0.9);
        font-size: 1rem;
    }
    
    .vecy-combos-section .vecy-view-all {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border-color: rgba(255, 255, 255, 0.3);
        backdrop-filter: blur(10px);
    }
    
    .vecy-combos-section .vecy-view-all:hover {
        background: white;
        color: #667eea;
        transform: translateX(8px);
    }
    
    /* Grid de combos más compacto */
    .vecy-combos-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        gap: 20px;
        margin-top: 25px;
    }
    
    .vecy-combo-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        height: 100%;
        display: flex;
        flex-direction: column;
        min-height: 420px;
    }
    
    .vecy-combo-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.25);
        border-color: rgba(255, 255, 255, 0.5);
    }
    
    .vecy-combo-badge {
        position: absolute;
        top: 12px;
        left: 12px;
        background: linear-gradient(135deg, #FF6B6B, #FF8E53);
        color: white;
        padding: 6px 12px;
        border-radius: 15px;
        font-size: 0.7rem;
        font-weight: 700;
        z-index: 10;
        box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    /* IMAGEN PRINCIPAL DEL COMBO - MÁS COMPACTA */
    .vecy-combo-media {
        position: relative;
        height: 160px;
        overflow: hidden;
        background: linear-gradient(135deg, #667eea, #764ba2);
        flex-shrink: 0;
    }
    
    .vecy-combo-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
        opacity: 0.9;
    }
    
    .vecy-combo-card:hover .vecy-combo-image {
        transform: scale(1.1);
        opacity: 1;
    }
    
    .vecy-combo-placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        color: white;
        background: linear-gradient(135deg, #667eea, #764ba2);
    }
    
    .vecy-combo-count {
        position: absolute;
        bottom: 12px;
        right: 12px;
        background: rgba(255, 255, 255, 0.95);
        color: #667eea;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 5px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.5);
        z-index: 5;
    }
    
    /* MINIATURAS DE PRODUCTOS DEL COMBO - ¡AHORA MÁS GRANDES! */
    .vecy-combo-products-mini {
        position: absolute;
        bottom: 12px;
        left: 12px;
        display: flex;
        gap: 8px;
        z-index: 5;
    }
    
    .vecy-product-mini {
        width: 120px; /* Aumentado de 45px a 70px */
        height: 120px; /* Aumentado de 45px a 70px */
        border-radius: 12px; /* Aumentado de 10px a 12px */
        overflow: hidden;
        border: 3px solid white;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        background: white;
        animation: miniFloat 3s ease-in-out infinite;
    }
    
    .vecy-product-mini:nth-child(1) { animation-delay: 0s; }
    .vecy-product-mini:nth-child(2) { animation-delay: 0.2s; }
    .vecy-product-mini:nth-child(3) { animation-delay: 0.4s; }
    
    @keyframes miniFloat {
        0%, 100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-5px);
        }
    }
    
    .vecy-product-mini:hover {
        animation: collide 0.3s ease-in-out;
        z-index: 10;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        transform: scale(1.1);
    }
    
    @keyframes collide {
        0% {
            transform: translateX(0) scale(1.1);
        }
        25% {
            transform: translateX(-4px) scale(1.1);
        }
        75% {
            transform: translateX(4px) scale(1.1);
        }
        100% {
            transform: translateX(0) scale(1.1);
        }
    }
    
    .vecy-product-mini-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }
    
    .vecy-product-mini-img:hover {
        transform: scale(1.1);
    }
    
    .vecy-product-mini-placeholder {
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #FF9A9E, #FAD0C4);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.4rem;
        font-weight: bold;
    }
    
    .mini-quantity {
        position: absolute;
        bottom: 5px;
        right: 5px;
        background: rgba(255, 255, 255, 0.9);
        color: #333;
        padding: 2px 6px;
        border-radius: 8px;
        font-size: 0.7rem;
        font-weight: bold;
    }
    
    /* CONTENIDO DEL COMBO */
    .vecy-combo-content {
        padding: 16px;
        background: white;
        border-radius: 0 0 16px 16px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
    }
    
    .vecy-combo-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: #333;
        margin-bottom: 8px;
        line-height: 1.3;
        min-height: 2.6em;
    }
    
    .vecy-combo-description {
        color: #666;
        font-size: 0.8rem;
        line-height: 1.4;
        margin-bottom: 10px;
        flex-grow: 0;
        min-height: 2.4em;
    }
    
    .vecy-combo-store {
        display: flex;
        align-items: center;
        gap: 6px;
        color: #667eea;
        font-size: 0.8rem;
        font-weight: 600;
        margin-bottom: 10px;
    }
    
    .vecy-combo-price {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        padding: 10px;
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
        border-radius: 10px;
        border: 1px solid rgba(102, 126, 234, 0.2);
    }
    
    .vecy-price-comparison {
        display: flex;
        align-items: baseline;
        gap: 8px;
    }
    
    .vecy-combo-final {
        font-size: 1.4rem;
        font-weight: 800;
        color: #667eea;
        text-shadow: 0 2px 5px rgba(102, 126, 234, 0.2);
    }
    
    .vecy-combo-original {
        font-size: 0.9rem;
        text-decoration: line-through;
        color: #999;
        font-weight: 500;
    }
    
    .vecy-combo-discount-tag {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 3px 8px;
        border-radius: 15px;
        font-size: 0.7rem;
        font-weight: 700;
        box-shadow: 0 3px 8px rgba(102, 126, 234, 0.3);
    }
    
    .vecy-combo-savings {
        display: flex;
        align-items: center;
        gap: 6px;
        color: #667eea;
        font-size: 0.8rem;
        font-weight: 600;
        margin-bottom: 10px;
        padding: 6px 10px;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 8px;
    }
    
    .vecy-combo-stock {
        margin-bottom: 10px;
        flex-grow: 0;
    }
    
    .vecy-stock-bar {
        height: 5px;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 3px;
        overflow: hidden;
        margin-bottom: 5px;
    }
    
    .vecy-stock-progress {
        height: 100%;
        background: linear-gradient(90deg, #667eea, #764ba2);
        border-radius: 3px;
        transition: width 0.5s ease;
    }
    
    .vecy-combo-stock span {
        font-size: 0.75rem;
        color: #666;
    }
    
    /* PRODUCTOS INCLUIDOS - SOLO TEXTO COMO ANTES */
    .vecy-combo-products {
        margin-bottom: 12px;
        padding: 10px;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.3));
        border-radius: 10px;
        border: 2px dashed rgba(102, 126, 234, 0.3);
        flex-grow: 1;
        max-height: 90px;
        overflow-y: auto;
        transition: all 0.3s ease;
    }
    
    .vecy-combo-products:hover {
        border-color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
    }
    
    .vecy-combo-products small {
        display: block;
        color: #667eea;
        font-weight: 600;
        margin-bottom: 6px;
        font-size: 0.8rem;
    }
    
    .vecy-products-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 5px;
    }
    
    .vecy-product-badge {
        background: white;
        color: #667eea;
        padding: 4px 8px;
        border-radius: 10px;
        font-size: 0.7rem;
        font-weight: 500;
        border: 1px solid rgba(102, 126, 234, 0.3);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 4px;
        text-align: left;
        line-height: 1.2;
        cursor: pointer;
    }
    
    .vecy-product-badge:hover {
        background: #667eea;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        animation: badgeShake 0.3s ease-in-out;
    }
    
    @keyframes badgeShake {
        0%, 100% {
            transform: translateY(-2px) rotate(0);
        }
        25% {
            transform: translateY(-2px) rotate(-1deg);
        }
        75% {
            transform: translateY(-2px) rotate(1deg);
        }
    }
    
    /* ACCIONES */
    .vecy-combo-actions {
        display: flex;
        gap: 8px;
        margin-top: auto;
        padding-top: 8px;
    }
    
    .vecy-combo-btn {
        flex: 1;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 10px 14px;
        border-radius: 10px;
        font-weight: 600;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }
    
    .vecy-combo-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        background: linear-gradient(135deg, #5a6fd8, #6a42a5);
        animation: buttonPulse 0.5s ease-in-out;
    }
    
    @keyframes buttonPulse {
        0% {
            transform: translateY(-2px) scale(1);
        }
        50% {
            transform: translateY(-2px) scale(1.05);
        }
        100% {
            transform: translateY(-2px) scale(1);
        }
    }
    
    .vecy-favorite-combo-btn {
        width: 40px;
        background: white;
        color: #667eea;
        border: 2px solid rgba(102, 126, 234, 0.3);
        padding: 8px;
        border-radius: 10px;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }
    
    .vecy-favorite-combo-btn:hover {
        background: #667eea;
        color: white;
        border-color: #667eea;
        transform: scale(1.1);
        animation: heartBeat 0.5s ease-in-out;
    }
    
    @keyframes heartBeat {
        0%, 100% {
            transform: scale(1.1);
        }
        50% {
            transform: scale(1.2);
        }
    }
    
    /* CARRUSEL DE NAVIDAD - MEJORADO */
    .vecy-special-carousel-container {
        margin-bottom: 3rem;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        background: linear-gradient(135deg, rgba(220, 38, 38, 0.1), rgba(220, 38, 38, 0.05));
    }
    
    .vecy-special-carousel {
        border-radius: 20px;
        min-height: 400px;

    }
    
    .vecy-special-slide {
        position: relative;
        min-height: 400px;
        border-radius: 20px;
        overflow: hidden;
        padding: 50px !important   ;
    }
    
    .vecy-special-background {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }
    
    .vecy-special-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        filter: brightness(0.5) saturate(1.2);
    }
    
    .vecy-special-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0.4) 100%);
    }
    
    .vecy-special-content {
        position: relative;
        z-index: 2;
        color: white;
    }
    
    .vecy-special-badges {
        margin-bottom: 1.5rem;
    }
    
    .vecy-special-badge {
        background: linear-gradient(135deg, #dc2626, #ef4444);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 25px;
        font-size: 0.8rem;
        font-weight: 600;
        margin-right: 0.5rem;
        display: inline-block;
        box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
    }
    
    .vecy-special-offer {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 25px;
        font-size: 0.8rem;
        font-weight: 600;
        margin-right: 0.5rem;
        display: inline-block;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    .vecy-special-title {
        font-size: 2.2rem;
        font-weight: 800;
        margin-bottom: 1rem;
        color: white;
        text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
    }
    
    .vecy-special-description {
        font-size: 1rem;
        margin-bottom: 1.5rem;
        color: #f0f0f0;
        opacity: 0.9;
        line-height: 1.6;
    }
    
    /* ==================== */
    /* CORRECCIONES CRÍTICAS PARA EL GRID - EVITAR CONFLICTOS */
    /* ==================== */
    
    /* ANULAR cualquier estilo conflictivo del CSS externo */
    .vecy-premium-homepage .vecy-products-showcase {
        display: grid !important;
        grid-template-columns: repeat(auto-fill, minmax(480px, 1fr)) !important;
        gap: 25px !important;
        margin-top: 30px !important;
    }
    
    /* Para pantallas grandes, 4 columnas */
    @media (min-width: 1400px) {
        .vecy-premium-homepage .vecy-products-showcase {
            grid-template-columns: repeat(4, 1fr) !important;
        }
    }
    
    /* Para pantallas medianas grandes, 3 columnas */
    @media (min-width: 992px) and (max-width: 1399px) {
        .vecy-premium-homepage .vecy-products-showcase {
            grid-template-columns: repeat(3, 1fr) !important;
        }
    }
    
    /* Para tablets, 2 columnas */
    @media (min-width: 768px) and (max-width: 991px) {
        .vecy-premium-homepage .vecy-products-showcase {
            grid-template-columns: repeat(2, 1fr) !important;
        }
    }
    
    /* Para móviles, 1 columna */
    @media (max-width: 767px) {
        .vecy-premium-homepage .vecy-products-showcase {
            grid-template-columns: 1fr !important;
        }
    }
    
    /* Mantener el tamaño consistente de las tarjetas */
    .vecy-premium-homepage .vecy-product-card {
        height: 500px !important; /* Altura fija para consistencia */
        display: flex !important;
        flex-direction: column !important;
    }
    
    /* Asegurar que el contenido se expanda correctamente */
    .vecy-premium-homepage .vecy-product-content {
        flex: 1 !important;
        display: flex !important;
        flex-direction: column !important;
    }
    
    /* Botón siempre al fondo */
    .vecy-premium-homepage .vecy-add-cart-btn,
    .vecy-premium-homepage .vecy-variant-actions {
        margin-top: auto !important;
    }
    
    /* ==================== */
    /* MEDIA QUERIES ADICIONALES - CORREGIDAS */
    /* ==================== */
    
    @media (max-width: 1200px) {
        .vecy-combos-grid {
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        }
        
        .vecy-premium-homepage .vecy-products-showcase {
            gap: 20px !important;
        }
    }
    
    @media (max-width: 992px) {
        .vecy-premium-homepage .vecy-products-showcase {
            gap: 20px !important;
        }
        
        .vecy-tech-carousel,
        .vecy-special-carousel {
            min-height: 350px;
        }
        
        .vecy-tech-content,
        .vecy-special-content {
            padding: 2rem !important;
        }
        
        .vecy-tech-title,
        .vecy-special-title {
            font-size: 1.8rem;
        }
        
        .vecy-combos-grid {
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        }
        
        .vecy-combo-media {
            height: 140px;
        }
        
        .vecy-product-mini {
            width: 60px;
            height: 60px;
        }
        
        .vecy-combo-card {
            min-height: 400px;
        }
    }
    
    @media (max-width: 768px) {
        .vecy-premium-homepage .vecy-products-showcase {
            gap: 15px !important;
        }
        
        .vecy-tech-carousel,
        .vecy-special-carousel {
            min-height: 300px;
        }
        
        .vecy-combos-grid {
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        .vecy-combo-card {
            margin: 0;
            min-height: 380px;
        }
        
        .vecy-combo-media {
            height: 130px;
        }
        
        .vecy-product-mini {
            width: 55px;
            height: 55px;
        }
        
        .vecy-products-list {
            grid-template-columns: repeat(2, 1fr);
        }
    }
    
    @media (max-width: 576px) {
        .vecy-premium-homepage .vecy-products-showcase {
            gap: 15px !important;
        }
        
        .vecy-tech-carousel,
        .vecy-special-carousel {
            min-height: 280px;
            padding: 15px;
        }
        
        .vecy-tech-content,
        .vecy-special-content {
            padding: 1.5rem !important;
        }
        
        .vecy-tech-title,
        .vecy-special-title {
            font-size: 1.5rem;
        }
        
        .vecy-combos-grid {
            gap: 15px;
        }
        
        .vecy-combo-card {
            min-height: 360px;
        }
        
        .vecy-combo-media {
            height: 120px;
        }
        
        .vecy-product-mini {
            width: 50px;
            height: 50px;
        }
        
        .vecy-products-list {
            grid-template-columns: 1fr;
        }
    }
    
    /* ===== ESTILOS PARA ENLACES DE PRODUCTO - MEJORADOS ===== */
    .vecy-product-card-link {
        text-decoration: none;
        color: inherit;
        display: block;
        transition: transform 0.3s ease;
        position: relative;
    }
    
    .vecy-product-card-link:hover {
        transform: translateY(-5px);
    }
    
    .vecy-product-card-link:hover .vecy-product-card {
        box-shadow: 0 15px 30px rgba(0,0,0,0.15);
    }
    
    .vecy-product-card-link .vecy-product-name {
        color: #2c3e50;
        transition: color 0.3s ease;
    }
    
    .vecy-product-card-link:hover .vecy-product-name {
        color: #3598db;
    }
    
    .vecy-product-card-link .vecy-product-image {
        transition: transform 0.5s ease;
    }
    
    .vecy-product-card-link:hover .vecy-product-image {
        transform: scale(1.05);
    }
    
    /* ===== ZONAS NO CLICKEABLES DENTRO DE LA TARJETA ===== */
    .vecy-no-click-zone {
        position: relative;
        z-index: 20;
    }
    
    /* Botones de acción - deben estar por encima del enlace */
    .vecy-add-cart-btn,
    .vecy-favorite-btn,
    .vecy-quick-view,
    .vecy-favorite-variant-btn,
    .vecy-product-overlay button,
    .vecy-combo-btn,
    .vecy-favorite-combo-btn,
    .vecy-2x1-btn,
    .vecy-favorite-2x1-btn,
    .vecy-tech-btn,
    .vecy-special-btn,
    .vecy-visit-btn {
        position: relative;
        z-index: 30 !important;
        pointer-events: auto !important;
        cursor: pointer;
    }
    
    /* Asegurar que los botones dentro de las tarjetas sean clickeables */
    .vecy-product-card .vecy-add-cart-btn,
    .vecy-product-card .vecy-favorite-variant-btn,
    .vecy-product-card .vecy-product-overlay button,
    .vecy-combo-card .vecy-combo-btn,
    .vecy-combo-card .vecy-favorite-combo-btn,
    .vecy-2x1-card .vecy-2x1-btn,
    .vecy-2x1-card .vecy-favorite-2x1-btn {
        position: relative;
        z-index: 100 !important;
    }
    
    /* Para combos y 2x1 también */
    .vecy-combo-card-link,
    .vecy-2x1-card-link {
        text-decoration: none;
        color: inherit;
        display: block;
    }
    
    /* Deshabilitar el puntero en áreas que no son botones pero están dentro del enlace */
    .vecy-product-card-link *:not(.vecy-add-cart-btn):not(.vecy-favorite-btn):not(.vecy-quick-view):not(.vecy-favorite-variant-btn):not(.vecy-combo-btn):not(.vecy-favorite-combo-btn):not(.vecy-2x1-btn):not(.vecy-favorite-2x1-btn):not(.vecy-tech-btn):not(.vecy-special-btn):not(.vecy-visit-btn) {
        cursor: pointer;
    }
    
    /* ===== MEJORAS PARA LA INTERACCIÓN ===== */
    .vecy-product-content,
    .vecy-combo-content,
    .vecy-2x1-content {
        position: relative;
    }
    
    /* Efecto overlay para indicar área clickeable */
    .vecy-clickable-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 5;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .vecy-product-card-link:hover .vecy-clickable-overlay {
        opacity: 0.05;
        background: linear-gradient(135deg, #3598db, #2ecc71);
    }
    
    /* ===== AJUSTES ESPECÍFICOS PARA BOTONES ===== */
    .vecy-add-cart-btn {
        background: linear-gradient(135deg, #3598db, #2ecc71);
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
        width: 100%;
        margin-top: 10px;
        position: relative;
        z-index: 100 !important;
    }
    
    .vecy-add-cart-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(53, 152, 219, 0.4);
        background: linear-gradient(135deg, #2980b9, #27ae60);
    }
    
    /* Botón de favoritos dentro de la tarjeta */
    .vecy-favorite-variant-btn {
        background: white;
        color: #e74c3c;
        border: 2px solid #e74c3c;
        padding: 8px 15px;
        border-radius: 8px;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        margin-top: 10px;
        position: relative;
        z-index: 100 !important;
    }
    
    .vecy-favorite-variant-btn:hover {
        background: #e74c3c;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
    }
    
    /* ===== CORRECCIÓN PARA VARIANT-ACTIONS ===== */
    .vecy-variant-actions {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        position: relative;
        z-index: 100 !important;
    }
    
    .vecy-variant-actions button {
        flex: 1;
        position: relative;
        z-index: 101 !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="vecy-premium-homepage">
    <!-- HERO SECTION CON CARRUSEL MEJORADO -->
    <section class="vecy-hero-section">
        <div class="vecy-hero-container">
            <!-- CARRUSEL DE OFERTAS RECIENTES -->
            {% if ofertas_carrusel %}
            <div id="vecyOffersCarousel" class="carousel slide vecy-hero-carousel" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    {% for oferta in ofertas_carrusel %}
                    <button type="button" data-bs-target="#vecyOffersCarousel" data-bs-slide-to="{{ forloop.counter0 }}"
                        {% if forloop.first %}class="active" {% endif %}></button>
                    {% endfor %}
                </div>

                <div class="carousel-inner">
                    {% for oferta in ofertas_carrusel %}
                    <div class="carousel-item vecy-hero-slide {% if forloop.first %}active{% endif %}">
                        <div class="vecy-hero-background">
                            <img src="{% if oferta.imagen_promo %}{{ oferta.imagen_promo }}{% else %}{% if oferta.fkproducto.img_prod %}{{ oferta.fkproducto.img_prod.url }}{% else %}https://images.unsplash.com/photo-1607082350899-7e105aa886ae?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80{% endif %}{% endif %}"
                                class="vecy-hero-image" alt="{{ oferta.titulo_promo }}">
                            <div class="vecy-hero-overlay"></div>
                        </div>

                        <div class="vecy-hero-content">
                            <div class="vecy-hero-badge">
                                <span class="vecy-flash-badge">
                                    <i class="fas fa-bolt me-1"></i>OFERTA ESPECIAL
                                </span>
                                <span class="vecy-time-badge">
                                    <i class="fas fa-clock me-1"></i>Tiempo Limitado
                                </span>
                            </div>

                            <h1 class="vecy-hero-title">{{ oferta.titulo_promo }}</h1>
                            <p class="vecy-hero-description">{{ oferta.descripcion_promo }}</p>

                            <div class="vecy-price-section">
                                <div class="vecy-price-display">
                                    <span class="vecy-final-price">${{ oferta.precio_final_formateado }}</span>
                                    <span class="vecy-original-price">${{ oferta.precio_base_formateado }}</span>
                                    <span class="vecy-discount-badge">-{{ oferta.porcentaje_descuento|floatformat:0}}%</span>
                                </div>
                                <div class="vecy-savings">
                                    <i class="fas fa-piggy-bank me-1"></i>
                                    Ahorras ${{ oferta.ahorro_oferta_formateado }}
                                </div>
                            </div>

                            <div class="vecy-hero-actions">
                                <button class="vecy-primary-btn vecy-large-btn"
                                    onclick="addToCart('{{ oferta.fkproducto.pkid_prod }}')">
                                    <i class="fas fa-shopping-cart me-2"></i>
                                    Comprar Ahora
                                </button>
                                <button class="vecy-secondary-btn vecy-large-btn"
                                    onclick="toggleFavorite('{{ oferta.fkproducto.pkid_prod }}', this)">
                                    <i class="fas fa-heart me-2"></i>
                                    Agregar a Favoritos
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <button class="carousel-control-prev vecy-carousel-control" type="button"
                    data-bs-target="#vecyOffersCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Anterior</span>
                </button>
                <button class="carousel-control-next vecy-carousel-control" type="button"
                    data-bs-target="#vecyOffersCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Siguiente</span>
                </button>
            </div>
            {% else %}
            <!-- HERO POR DEFECTO -->
            <div class="vecy-hero-default">
                <div class="vecy-hero-background">
                    <img src="https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80"
                        class="vecy-hero-image" alt="Bienvenido a VECY">
                    <div class="vecy-hero-overlay"></div>
                </div>
                <div class="vecy-hero-content">
                    <h1 class="vecy-hero-title">Bienvenido a VECY</h1>
                    <p class="vecy-hero-description">Tu mercado local digital con los mejores productos y servicios de
                        tu comunidad</p>
                    <div class="vecy-hero-actions">
                        <button class="vecy-primary-btn vecy-large-btn" onclick="window.location.href='#vecy-products'">
                            <i class="fas fa-shopping-bag me-2"></i>
                            Explorar Productos
                        </button>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </section>

    <!-- QUICK ACCESS BAR MEJORADO CON IMÁGENES REALES -->
    <section class="vecy-quick-access">
        <div class="container">
            <div class="vecy-quick-grid">
                <a href="#vecy-budget" class="vecy-quick-item">
                    <div class="vecy-quick-icon budget">
                        <img src="{%static 'img/celular.jpg'%}" alt="Productos Baratos">
                    </div>
                    <span class="vecy-quick-text">Productos Baratos</span>
                </a>
                <a href="#vecy-featured" class="vecy-quick-item">
                    <div class="vecy-quick-icon featured">
                        <img src="https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=100&h=100&fit=crop" alt="Destacados">
                    </div>
                    <span class="vecy-quick-text">Destacados</span>
                </a>
                <a href="#vecy-offers" class="vecy-quick-item">
                    <div class="vecy-quick-icon offers">
                        <img src="{%static 'img/Helado1.jpg'%}" alt="Ofertas">
                    </div>
                    <span class="vecy-quick-text">Ofertas</span>
                </a>
                <a href="#vecy-businesses" class="vecy-quick-item">
                    <div class="vecy-quick-icon businesses">
                        <img src="{%static 'img/tienda.jpg'%}" alt="Negocios">
                    </div>
                    <span class="vecy-quick-text">Negocios</span>
                </a>
            </div>
        </div>
    </section>

    <!-- OFERTAS ESPECIALES - CON VARIANTES INDIVIDUALES -->
    <section id="vecy-offers" class="vecy-section vecy-gradient-bg-3">
        <div class="container">
            <div class="vecy-section-header">
                <div class="vecy-header-content">
                    <div class="vecy-icon-header">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div>
                        <h2 class="vecy-section-title">Ofertas Especiales</h2>
                        <p class="vecy-section-subtitle">Descuentos exclusivos y promociones limitadas</p>
                    </div>
                </div>
                <a href="{% url 'productos_filtrados_logeado' %}?filtro=ofertas" class="vecy-view-all">
                    Ver todas <i class="fas fa-arrow-right"></i>
                </a>
            </div>

            {% if productos_oferta %}
            <!-- GRILLA DE OFERTAS -->
            <div class="vecy-products-showcase">
                {% for item in productos_oferta|slice:":12" %}
                <!-- ENLACE QUE CUBRE TODA LA TARJETA -->
                <a href="{% url 'producto_detalle_logeado' id=item.producto.pkid_prod %}" class="vecy-product-card-link" onclick="return vecyHandleCardClick(event, '{{ item.producto.pkid_prod }}')">
                    <div class="vecy-product-card variant-card" data-aos="fade-up" data-aos-delay="{{ forloop.counter0|add:1 }}00">
                        {% if item.es_variante %}
                        <div class="vecy-variant-badge">
                            <i class="fas fa-star"></i> VARIANTE
                        </div>
                        {% endif %}
                        
                        <div class="vecy-product-media">
                            <div class="vecy-image-container">
                                {% if item.imagen %}
                                <img src="{{ item.imagen }}" alt="{{ item.nombre_completo }}" class="vecy-product-image">
                                {% else %}
                                <div class="vecy-image-placeholder">
                                    <i class="fas fa-tag"></i>
                                </div>
                                {% endif %}

                                <div class="vecy-product-overlay">
                                    <button class="vecy-quick-view" type="button" onclick="vecyQuickView(event, '{{ item.producto.pkid_prod }}')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="vecy-favorite-btn" type="button" onclick="vecyToggleFavorite(event, '{{ item.producto.pkid_prod }}', this)">
                                        <i class="far fa-heart"></i>
                                    </button>
                                </div>

                                {% if item.tiene_oferta %}
                                <div class="vecy-discount-ribbon">
                                    -{{ item.descuento_porcentaje|floatformat:0 }}%
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="vecy-product-content">
                            <h3 class="vecy-product-name">{{ item.nombre_completo }}</h3>

                            <div class="vecy-store-info">
                                <i class="fas fa-store"></i>
                                <span>{{ item.producto.fknegocioasociado_prod.nom_neg }}</span>
                            </div>

                            <div class="vecy-stock-info {% if item.stock < 10 %}vecy-low-stock{% endif %}">
                                <i class="fas fa-box"></i>
                                <span>{{ item.stock }} disponibles</span>
                            </div>

                            <div class="vecy-price-section">
                                <div class="vecy-price-main">
                                    <span class="vecy-current-price">${{ item.precio_final_formateado }}</span>
                                    {% if item.tiene_oferta %}
                                    <span class="vecy-original-price">${{ item.precio_base_formateado }}</span>
                                    {% endif %}
                                </div>
                                {% if item.tiene_oferta %}
                                <div class="vecy-savings-badge">
                                    -{{ item.descuento_porcentaje|floatformat:0 }}% • Ahorras ${{ item.ahorro_formateado }}
                                </div>
                                {% endif %}
                            </div>

                            <!-- ÁREA DE BOTONES - NO CLICKEABLE POR EL ENLACE -->
                            <div class="vecy-variant-actions vecy-no-click-zone">
                                {% if item.id_variante %}
                                <button class="vecy-add-cart-btn" type="button"
                                        onclick="vecyAddToCart(event, '{{ item.producto.pkid_prod }}', '{{ item.id_variante }}')">
                                    <i class="fas fa-cart-plus me-2"></i>
                                    Agregar
                                </button>
                                {% else %}
                                <button class="vecy-add-cart-btn" type="button"
                                        onclick="vecyAddToCart(event, '{{ item.producto.pkid_prod }}')">
                                    <i class="fas fa-cart-plus me-2"></i>
                                    Agregar
                                </button>
                                {% endif %}
                                <button class="vecy-favorite-variant-btn" type="button"
                                        onclick="vecyToggleFavorite(event, '{{ item.producto.pkid_prod }}', this)">
                                    <i class="far fa-heart"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Overlay para área clickeable -->
                        <div class="vecy-clickable-overlay"></div>
                    </div>
                </a>
                {% endfor %}
            </div>
            {% else %}
            <div class="vecy-empty-state">
                <div class="vecy-empty-icon">
                    <i class="fas fa-tag"></i>
                </div>
                <h3>Ofertas Especiales</h3>
                <p>Pronto encontrarás aquí ofertas especiales y promociones limitadas.</p>
            </div>
            {% endif %}
        </div>
    </section>

<!-- ===== SECCIÓN DE COMBOS CORREGIDA ===== -->
{% if hay_combos_activos %}
<section id="vecy-combos" class="vecy-section vecy-combos-section">
    <div class="container">
        <div class="vecy-section-header">
            <div class="vecy-header-content">
                <div class="vecy-icon-header">
                    <i class="fas fa-boxes"></i>
                </div>
                <div>
                    <h2 class="vecy-section-title">Combos Especiales</h2>
                    <p class="vecy-section-subtitle">Paquetes con descuento - ¡Ahorra más comprando juntos!</p>
                </div>
            </div>
            <a href="{% url 'productos_filtrados_logeado' %}?filtro=combos" class="vecy-view-all">
                Ver todos <i class="fas fa-arrow-right"></i>
            </a>
        </div>

        <div class="vecy-combos-grid">
            {% for combo_data in combos_activos|slice:":6" %}
            <!-- Combo sin enlace de tarjeta completa -->
            <div class="vecy-combo-card" data-aos="zoom-in" data-aos-delay="{{ forloop.counter0|add:1 }}00">
                <!-- BADGE DE COMBO -->
                <div class="vecy-combo-badge">
                    <i class="fas fa-percentage"></i> COMBO ESPECIAL
                </div>

                <!-- ÁREA DE IMAGEN CON PRODUCTOS DEL COMBO -->
                <div class="vecy-combo-media">
                    <!-- IMAGEN PRINCIPAL DEL COMBO -->
                    {% if combo_data.imagen_url %}
                    <img src="{{ combo_data.imagen_url }}" alt="{{ combo_data.combo.nombre_combo }}" class="vecy-combo-image">
                    {% else %}
                    <div class="vecy-combo-placeholder">
                        <i class="fas fa-boxes"></i>
                    </div>
                    {% endif %}
                    
                    <!-- CONTADOR DE PRODUCTOS -->
                    <div class="vecy-combo-count">
                        <i class="fas fa-cube"></i>
                        {{ combo_data.cantidad_productos }} productos
                    </div>
                    
                    <!-- IMÁGENES DE PRODUCTOS DEL COMBO - ¡AHORA MÁS GRANDES! -->
                    <div class="vecy-combo-products-mini">
                        {% for producto_info in combo_data.productos|slice:":3" %}
                        <div class="vecy-product-mini" data-index="{{ forloop.counter0 }}">
                            {% if producto_info.producto.img_prod %}
                            <img src="{{ producto_info.producto.img_prod.url }}" 
                                 alt="{{ producto_info.producto.nom_prod }}" 
                                 class="vecy-product-mini-img"
                                 title="{{ producto_info.cantidad }}x {{ producto_info.producto.nom_prod }}">
                            <span class="mini-quantity">{{ producto_info.cantidad }}x</span>
                            {% else %}
                            <div class="vecy-product-mini-placeholder" 
                                 style="background: linear-gradient(135deg, 
                                        {% cycle '#FF6B6B' '#4ECDC4' '#45B7D1' as bgcolor %}, 
                                        {% cycle '#FF8E53' '#6FFFE9' '#A3D9FF' as bgcolor2 %});">
                                <i class="fas fa-box"></i>
                                <span class="mini-quantity">{{ producto_info.cantidad }}x</span>
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                        
                        {% if combo_data.cantidad_productos > 3 %}
                        <div class="vecy-product-mini more-products">
                            <div class="vecy-product-mini-placeholder" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                                +{{ combo_data.cantidad_productos|add:"-3" }}
                                <span class="mini-quantity">+{{ combo_data.cantidad_productos|add:"-3" }}</span>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- CONTENIDO DEL COMBO -->
                <div class="vecy-combo-content">
                    <h3 class="vecy-combo-title">{{ combo_data.combo.nombre_combo }}</h3>
                    
                    <div class="vecy-combo-description">
                        <p>{{ combo_data.combo.descripcion_combo|default:"Combo especial con productos seleccionados"|truncatechars:60 }}</p>
                    </div>

                    <div class="vecy-combo-store">
                        <i class="fas fa-store"></i>
                        {{ combo_data.negocio.nom_neg }}
                    </div>

                    <div class="vecy-combo-price">
                        <div class="vecy-price-comparison">
                            <span class="vecy-combo-final">${{ combo_data.precio_combo_formateado }}</span>
                            <span class="vecy-combo-original">${{ combo_data.precio_regular_formateado }}</span>
                        </div>
                        <div class="vecy-combo-discount-tag">
                            -{{ combo_data.descuento_porcentaje|floatformat:0 }}%
                        </div>
                    </div>

                    <div class="vecy-combo-savings">
                        <i class="fas fa-piggy-bank me-1"></i>
                        Ahorras ${{ combo_data.ahorro_formateado }}
                    </div>

                    <!-- LISTA DE PRODUCTOS INCLUIDOS - SOLO TEXTO COMO ANTES -->
                    <div class="vecy-combo-products">
                        <small><i class="fas fa-gift me-1"></i>Productos incluidos:</small>
                        <div class="vecy-products-list">
                            {% for producto_info in combo_data.productos|slice:":4" %}
                            <div class="vecy-product-badge" onclick="window.location.href='{% url 'producto_detalle_logeado' id=producto_info.producto.pkid_prod %}'">
                                <i class="fas fa-check-circle"></i>
                                {{ producto_info.cantidad }}x {{ producto_info.producto.nom_prod|truncatechars:20 }}
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="vecy-combo-actions">
                        <button class="vecy-combo-btn" 
                                onclick="addComboToCart('{{ combo_data.combo.pkid_combo }}')">
                            <i class="fas fa-cart-plus me-2"></i>
                            Agregar Combo
                        </button>
                        <button class="vecy-favorite-combo-btn" 
                                onclick="toggleFavoriteCombo('{{ combo_data.combo.pkid_combo }}', this)">
                            <i class="far fa-heart"></i>
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

    <!-- SECCIÓN DE PROMOCIONES 2X1 -->
    {% if hay_promociones_2x1 %}
    <section id="vecy-2x1" class="vecy-section vecy-gradient-bg-2x1">
        <div class="container">
            <div class="vecy-section-header">
                <div class="vecy-header-content">
                    <div class="vecy-icon-header">
                        <i class="fas fa-tags"></i>
                    </div>
                    <div>
                        <h2 class="vecy-section-title">¡2x1!</h2>
                        <p class="vecy-section-subtitle">Lleva 2 por el precio de 1 - Ofertas increíbles</p>
                    </div>
                </div>
                <a href="{% url 'productos_filtrados_logeado' %}?filtro=2x1" class="vecy-view-all">
                    Ver todos <i class="fas fa-arrow-right"></i>
                </a>
            </div>

            <div class="vecy-2x1-grid">
                {% for promo_data in promociones_2x1|slice:":6" %}
                <!-- 2x1 sin enlace de tarjeta completa -->
                <div class="vecy-2x1-card" data-aos="zoom-in" data-aos-delay="{{ forloop.counter0|add:1 }}00">
                    <div class="vecy-2x1-badge">
                        <i class="fas fa-bolt"></i> 2x1
                    </div>

                    <div class="vecy-2x1-media">
                        {% if promo_data.imagen_url %}
                        <img src="{{ promo_data.imagen_url }}" alt="{{ promo_data.producto.nom_prod }}" class="vecy-2x1-image">
                        {% else %}
                        <div class="vecy-2x1-placeholder">
                            <i class="fas fa-tags"></i>
                        </div>
                        {% endif %}
                        
                        <div class="vecy-2x1-count">
                            <i class="fas fa-shopping-cart"></i>
                            Lleva 2 paga 1
                        </div>
                    </div>

                    <div class="vecy-2x1-content">
                        <h3 class="vecy-2x1-title">
                            {{ promo_data.producto.nom_prod }}
                            {% if promo_data.variante_nombre %}
                            <br><small>{{ promo_data.variante_nombre }}</small>
                            {% endif %}
                        </h3>

                        <div class="vecy-2x1-store">
                            <i class="fas fa-store"></i>
                            {{ promo_data.negocio.nom_neg }}
                        </div>

                        <div class="vecy-2x1-price">
                            <div class="vecy-price-comparison">
                                <span class="vecy-2x1-final">${{ promo_data.precio_unitario_oferta_formateado }}/unidad</span>
                                <span class="vecy-2x1-original">${{ promo_data.precio_original_formateado }}/unidad</span>
                            </div>
                            <div class="vecy-2x1-discount-tag">
                                -50%
                            </div>
                        </div>

                        <div class="vecy-2x1-savings">
                            <i class="fas fa-piggy-bank me-1"></i>
                            Ahorras ${{ promo_data.ahorro_monto_formateado }} por par
                        </div>

                        <div class="vecy-2x1-stock">
                            <div class="vecy-stock-bar">
                                <div class="vecy-stock-progress"
                                    style="width: {% widthratio promo_data.stock 10 100 %}%"></div>
                            </div>
                            <span>{{ promo_data.stock }} disponibles</span>
                        </div>

                        <div class="vecy-2x1-info">
                            <div class="vecy-info-item">
                                <i class="fas fa-calendar-alt"></i>
                                Válido hasta: {{ promo_data.promocion.fecha_fin|date:"d/m/Y" }}
                            </div>
                        </div>

                        <div class="vecy-2x1-actions">
                            <button class="vecy-2x1-btn" 
                                    onclick="add2x1ToCart('{{ promo_data.promocion.pkid_promo_2x1 }}')">
                                <i class="fas fa-cart-plus me-2"></i>
                                Aprovechar 2x1
                            </button>
                            <button class="vecy-favorite-2x1-btn" 
                                    onclick="toggleFavorite('{{ promo_data.producto.pkid_prod }}', this)">
                                <i class="far fa-heart"></i>
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>
    {% endif %}

    <!-- PRODUCTOS DESTACADOS CON VARIANTES INDIVIDUALES -->
    <section id="vecy-featured" class="vecy-section vecy-gradient-bg-2">
        <div class="container">
            <div class="vecy-section-header">
                <div class="vecy-header-content">
                    <div class="vecy-icon-header">
                        <i class="fas fa-star"></i>
                    </div>
                    <div>
                        <h2 class="vecy-section-title">Productos Destacados</h2>
                        <p class="vecy-section-subtitle">Los productos más populares y mejor valorados</p>
                    </div>
                </div>
                <a href="{% url 'productos_filtrados_logeado' %}?filtro=destacados" class="vecy-view-all">
                    Ver todos <i class="fas fa-arrow-right"></i>
                </a>
            </div>

            {% if productos_destacados %}
            <div class="vecy-products-showcase">
                {% for item in productos_destacados|slice:":12" %}
                <!-- ENLACE QUE CUBRE TODA LA TARJETA -->
                <a href="{% url 'producto_detalle_logeado' id=item.producto.pkid_prod %}" class="vecy-product-card-link" onclick="return vecyHandleCardClick(event, '{{ item.producto.pkid_prod }}')">
                    <div class="vecy-product-card vecy-featured-card variant-card" data-aos="fade-up" data-aos-delay="{{ forloop.counter0|add:1 }}00">
                        {% if item.es_variante %}
                        <div class="vecy-variant-badge">
                            <i class="fas fa-star"></i> VARIANTE
                        </div>
                        {% endif %}
                        
                        <div class="vecy-product-media">
                            <div class="vecy-image-container">
                                {% if item.imagen %}
                                <img src="{{ item.imagen }}" alt="{{ item.nombre_completo }}" class="vecy-product-image">
                                {% else %}
                                <div class="vecy-image-placeholder">
                                    <i class="fas fa-star"></i>
                                </div>
                                {% endif %}

                                <div class="vecy-product-overlay">
                                    <button class="vecy-quick-view" type="button" onclick="vecyQuickView(event, '{{ item.producto.pkid_prod }}')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="vecy-favorite-btn" type="button" onclick="vecyToggleFavorite(event, '{{ item.producto.pkid_prod }}', this)">
                                        <i class="far fa-heart"></i>
                                    </button>
                                </div>

                                {% if item.tiene_oferta %}
                                <div class="vecy-discount-ribbon">
                                    -{{ item.descuento_porcentaje|floatformat:0 }}%
                                </div>
                                {% endif %}

                                <div class="vecy-featured-badge">
                                    <i class="fas fa-crown"></i> Destacado
                                </div>
                            </div>

                            <div class="vecy-product-badges">
                                <span class="vecy-badge vecy-featured-badge">
                                    <i class="fas fa-star me-1"></i>Popular
                                </span>
                                {% if item.total_vendido %}
                                <span class="vecy-badge vecy-sales-badge">
                                    <i class="fas fa-fire me-1"></i>{{ item.total_vendido }} vendidos
                                </span>
                                {% endif %}
                            </div>
                        </div>

                        <div class="vecy-product-content">
                            <h3 class="vecy-product-name">{{ item.nombre_completo }}</h3>

                            <div class="vecy-store-info">
                                <i class="fas fa-store"></i>
                                <span>{{ item.producto.fknegocioasociado_prod.nom_neg }}</span>
                            </div>

                            <div class="vecy-stock-info {% if item.stock < 10 %}vecy-low-stock{% endif %}">
                                <i class="fas fa-box"></i>
                                <span>{{ item.stock }} disponibles</span>
                            </div>

                            <div class="vecy-price-section">
                                <div class="vecy-price-main">
                                    <span class="vecy-current-price">${{ item.precio_final_formateado }}</span>
                                    {% if item.tiene_oferta %}
                                    <span class="vecy-original-price">${{ item.precio_base_formateado }}</span>
                                    {% endif %}
                                </div>
                                {% if item.tiene_oferta %}
                                <div class="vecy-savings-badge">
                                    -{{ item.descuento_porcentaje|floatformat:0 }}% • Ahorras ${{ item.ahorro_formateado }}
                                </div>
                                {% endif %}
                            </div>

                            <!-- ÁREA DE BOTONES - NO CLICKEABLE POR EL ENLACE -->
                            <div class="vecy-no-click-zone">
                                {% if item.id_variante %}
                                <button class="vecy-add-cart-btn" type="button"
                                        onclick="vecyAddToCart(event, '{{ item.producto.pkid_prod }}', '{{ item.id_variante }}')">
                                    <i class="fas fa-cart-plus me-2"></i>
                                    Agregar
                                </button>
                                {% else %}
                                <button class="vecy-add-cart-btn" type="button"
                                        onclick="vecyAddToCart(event, '{{ item.producto.pkid_prod }}')">
                                    <i class="fas fa-cart-plus me-2"></i>
                                    Agregar
                                </button>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Overlay para área clickeable -->
                        <div class="vecy-clickable-overlay"></div>
                    </div>
                </a>
                {% endfor %}
            </div>
            {% else %}
            <div class="vecy-empty-state">
                <div class="vecy-empty-icon">
                    <i class="fas fa-star"></i>
                </div>
                <h3>Productos Destacados</h3>
                <p>Pronto encontrarás aquí los productos más populares y mejor valorados.</p>
            </div>
            {% endif %}
        </div>
    </section>

    <!-- SECCIÓN DE FECHA ESPECIAL (NAVIDAD, ETC) CON CARRUSEL -->
    {% if hay_fecha_especial and hay_productos_fecha_especial %}
    <section id="vecy-special-date" class="vecy-section vecy-special-date-section">
        <div class="container">
            <div class="vecy-section-header">
                <div class="vecy-header-content">
                    <div class="vecy-icon-header special-icon">
                        {% if fecha_especial == "navidad" %}
                        <i class="fas fa-tree"></i>
                        {% elif fecha_especial == "san_valentin" %}
                        <i class="fas fa-heart"></i>
                        {% elif fecha_especial == "dia_madre" %}
                        <i class="fas fa-heart"></i>
                        {% elif fecha_especial == "dia_padre" %}
                        <i class="fas fa-user-tie"></i>
                        {% elif fecha_especial == "black_friday" %}
                        <i class="fas fa-shopping-bag"></i>
                        {% elif fecha_especial == "ano_nuevo" %}
                        <i class="fas fa-glass-cheers"></i>
                        {% elif fecha_especial == "fiestas_patrias" %}
                        <i class="fas fa-flag"></i>
                        {% else %}
                        <i class="fas fa-gift"></i>
                        {% endif %}
                    </div>
                    <div>
                        <h2 class="vecy-section-title">{{ mensaje_especial }}</h2>
                        <p class="vecy-section-subtitle">Productos especiales para esta temporada</p>
                    </div>
                </div>
                <a href="{% url 'productos_filtrados_logeado' %}?filtro=especiales" class="vecy-view-all">
                    Ver todos <i class="fas fa-arrow-right"></i>
                </a>
            </div>

            <!-- CARRUSEL ESPECIAL PARA NAVIDAD -->
            {% if fecha_especial == "navidad" %}
            <div class="vecy-special-carousel-container mb-5">
                <div id="vecySpecialCarousel" class="carousel slide vecy-special-carousel" data-bs-ride="carousel">
                    <div class="carousel-indicators special-indicators">
                        {% for item in productos_fecha_especial|slice:":5" %}
                            {% if item.tiene_oferta %}
                                <button type="button" data-bs-target="#vecySpecialCarousel" data-bs-slide-to="{{ forloop.counter0 }}"
                                    {% if forloop.first %}class="active" {% endif %}></button>
                            {% endif %}
                        {% endfor %}
                    </div>

                    <div class="carousel-inner vecy-special-inner">
                        {% for item in productos_fecha_especial|slice:":5" %}
                            {% if item.tiene_oferta %}
                            <div class="carousel-item vecy-special-slide {% if forloop.first %}active{% endif %}">
                                <div class="vecy-special-background">
                                    <img src="{% if item.imagen %}{{ item.imagen }}{% else %}https://images.unsplash.com/photo-1544717305-2782549b5136?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80{% endif %}"
                                        class="vecy-special-image" alt="{{ item.nombre_completo }}">
                                    <div class="vecy-special-overlay"></div>
                                </div>

                                <div class="vecy-special-content">
                                    <div class="row align-items-center">
                                        <div class="col-lg-6" data-aos="fade-right">
                                            <div class="vecy-special-badges">
                                                <span class="vecy-special-badge">
                                                    <i class="fas fa-gift me-2"></i>ESPECIAL NAVIDAD
                                                </span>
                                                <span class="vecy-special-offer">
                                                    <i class="fas fa-snowflake me-2"></i>Oferta Limitada
                                                </span>
                                            </div>

                                            <h3 class="vecy-special-title">{{ item.nombre_completo }}</h3>
                                            <p class="vecy-special-description">
                                                El regalo perfecto para esta Navidad. ¡No te quedes sin el tuyo!
                                            </p>

                                            <div class="vecy-special-price">
                                                <div class="vecy-price-display special">
                                                    <span class="vecy-final-price special">${{ item.precio_final_formateado }}</span>
                                                    <span class="vecy-original-price special">${{ item.precio_base_formateado }}</span>
                                                    <span class="vecy-discount-badge special">
                                                        -{{ item.descuento_porcentaje|floatformat:0 }}% OFF
                                                    </span>
                                                </div>
                                                <div class="vecy-special-savings">
                                                    <i class="fas fa-sleigh me-2"></i>
                                                    Ahorras ${{ item.ahorro_formateado }}
                                                </div>
                                            </div>

                                            <div class="vecy-special-info">
                                                <div class="vecy-info-item special">
                                                    <i class="fas fa-store"></i>
                                                    <span>{{ item.producto.fknegocioasociado_prod.nom_neg }}</span>
                                                </div>
                                                <div class="vecy-info-item special">
                                                    <i class="fas fa-box"></i>
                                                    <span>{{ item.stock }} disponibles</span>
                                                </div>
                                            </div>

                                            <div class="vecy-special-actions">
                                                {% if item.id_variante %}
                                                <button class="vecy-special-btn primary" 
                                                        onclick="addToCartWithSpecificVariant('{{ item.producto.pkid_prod }}', '{{ item.id_variante }}')">
                                                    <i class="fas fa-shopping-cart me-2"></i>
                                                    Comprar Ahora
                                                </button>
                                                {% else %}
                                                <button class="vecy-special-btn primary" 
                                                        onclick="addToCart('{{ item.producto.pkid_prod }}')">
                                                    <i class="fas fa-shopping-cart me-2"></i>
                                                    Comprar Ahora
                                                </button>
                                                {% endif %}
                                                <button class="vecy-special-btn secondary" onclick="toggleFavorite('{{ item.producto.pkid_prod }}', this)">
                                                    <i class="fas fa-heart me-2"></i>
                                                    Favorito
                                                </button>
                                            </div>
                                        </div>

                                        <div class="col-lg-6" data-aos="fade-left">
                                            <div class="vecy-special-product-image">
                                                {% if item.imagen %}
                                                <img src="{{ item.imagen }}" alt="{{ item.nombre_completo }}" 
                                                     class="img-fluid special-product-img">
                                                {% else %}
                                                <div class="vecy-special-placeholder">
                                                    <i class="fas fa-gift"></i>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        {% empty %}
                        <!-- SI NO HAY OFERTAS, MOSTRAR UN MENSAJE -->
                        <div class="carousel-item vecy-special-slide active">
                            <div class="vecy-special-background">
                                <img src="https://images.unsplash.com/photo-1544717305-2782549b5136?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80"
                                    class="vecy-special-image" alt="Sin ofertas especiales">
                                <div class="vecy-special-overlay"></div>
                            </div>
                            <div class="vecy-special-content">
                                <div class="row align-items-center">
                                    <div class="col-lg-12 text-center">
                                        <div class="vecy-special-badges">
                                            <span class="vecy-special-badge">
                                                <i class="fas fa-gift me-2"></i>ESPECIAL NAVIDAD
                                            </span>
                                        </div>
                                        <h3 class="vecy-special-title">Próximamente Ofertas Especiales</h3>
                                        <p class="vecy-special-description">
                                            Estamos preparando ofertas especiales de Navidad. ¡Vuelve pronto para descubrirlas!
                                        </p>
                                        <div class="vecy-special-actions">
                                            <button class="vecy-special-btn primary" onclick="window.location.href='#vecy-products'">
                                                <i class="fas fa-shopping-bag me-2"></i>
                                                Explorar Productos
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <button class="carousel-control-prev vecy-special-control" type="button"
                        data-bs-target="#vecySpecialCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon special" aria-hidden="true"></span>
                        <span class="visually-hidden">Anterior</span>
                    </button>
                    <button class="carousel-control-next vecy-special-control" type="button"
                        data-bs-target="#vecySpecialCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon special" aria-hidden="true"></span>
                        <span class="visually-hidden">Siguiente</span>
                    </button>
                </div>
            </div>
            {% endif %}

            <!-- GRILLA DE PRODUCTOS (CON VARIANTES INDIVIDUALES) -->
            <div class="vecy-products-showcase">
                {% for item in productos_fecha_especial|slice:":8" %}
                <!-- ENLACE QUE CUBRE TODA LA TARJETA -->
                <a href="{% url 'producto_detalle_logeado' id=item.producto.pkid_prod %}" class="vecy-product-card-link" onclick="return vecyHandleCardClick(event, '{{ item.producto.pkid_prod }}')">
                    <div class="vecy-product-card vecy-special-card variant-card" data-aos="fade-up" data-aos-delay="{{ forloop.counter0|add:1 }}00">
                        {% if item.es_variante %}
                        <div class="vecy-variant-badge">
                            <i class="fas fa-star"></i> VARIANTE
                        </div>
                        {% endif %}
                        
                        <div class="vecy-product-media">
                            <div class="vecy-image-container">
                                {% if item.imagen %}
                                <img src="{{ item.imagen }}" alt="{{ item.nombre_completo }}" class="vecy-product-image">
                                {% else %}
                                <div class="vecy-image-placeholder">
                                    {% if fecha_especial == "navidad" %}
                                    <i class="fas fa-tree"></i>
                                    {% elif fecha_especial == "san_valentin" %}
                                    <i class="fas fa-heart"></i>
                                    {% elif fecha_especial == "dia_madre" %}
                                    <i class="fas fa-heart"></i>
                                    {% elif fecha_especial == "dia_padre" %}
                                    <i class="fas fa-user-tie"></i>
                                    {% elif fecha_especial == "black_friday" %}
                                    <i class="fas fa-tag"></i>
                                    {% elif fecha_especial == "ano_nuevo" %}
                                    <i class="fas fa-glass-cheers"></i>
                                    {% elif fecha_especial == "fiestas_patrias" %}
                                    <i class="fas fa-flag"></i>
                                    {% else %}
                                    <i class="fas fa-gift"></i>
                                    {% endif %}
                                </div>
                                {% endif %}

                                <div class="vecy-product-overlay">
                                    <button class="vecy-quick-view" type="button" onclick="vecyQuickView(event, '{{ item.producto.pkid_prod }}')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="vecy-favorite-btn" type="button" onclick="vecyToggleFavorite(event, '{{ item.producto.pkid_prod }}', this)">
                                        <i class="far fa-heart"></i>
                                    </button>
                                </div>

                                {% if item.tiene_oferta %}
                                <div class="vecy-discount-ribbon">
                                    -{{ item.descuento_porcentaje|floatformat:0 }}%
                                </div>
                                {% endif %}

                                <div class="vecy-special-badge">
                                    {% if fecha_especial == "navidad" %}
                                    <i class="fas fa-tree"></i> Navidad
                                    {% elif fecha_especial == "san_valentin" %}
                                    <i class="fas fa-heart"></i> San Valentín
                                    {% elif fecha_especial == "dia_madre" %}
                                    <i class="fas fa-heart"></i> Día Madre
                                    {% elif fecha_especial == "dia_padre" %}
                                    <i class="fas fa-user-tie"></i> Día Padre
                                    {% elif fecha_especial == "black_friday" %}
                                    <i class="fas fa-tag"></i> Black Friday
                                    {% elif fecha_especial == "ano_nuevo" %}
                                    <i class="fas fa-glass-cheers"></i> Año Nuevo
                                    {% elif fecha_especial == "fiestas_patrias" %}
                                    <i class="fas fa-flag"></i> Fiestas Patrias
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="vecy-product-content">
                            <h3 class="vecy-product-name">{{ item.nombre_completo }}</h3>

                            <div class="vecy-store-info">
                                <i class="fas fa-store"></i>
                                <span>{{ item.producto.fknegocioasociado_prod.nom_neg }}</span>
                            </div>

                            <div class="vecy-stock-info {% if item.stock < 10 %}vecy-low-stock{% endif %}">
                                <i class="fas fa-box"></i>
                                <span>{{ item.stock }} disponibles</span>
                            </div>

                            <div class="vecy-price-section">
                                <div class="vecy-price-main">
                                    <span class="vecy-current-price">${{ item.precio_final_formateado }}</span>
                                    {% if item.tiene_oferta %}
                                    <span class="vecy-original-price">${{ item.precio_base_formateado }}</span>
                                    {% endif %}
                                </div>
                                {% if item.tiene_oferta %}
                                <div class="vecy-savings-badge">
                                    -{{ item.descuento_porcentaje|floatformat:0 }}% • Ahorras ${{ item.ahorro_formateado }}
                                </div>
                                {% endif %}
                            </div>

                            <!-- ÁREA DE BOTONES - NO CLICKEABLE POR EL ENLACE -->
                            <div class="vecy-no-click-zone">
                                {% if item.id_variante %}
                                <button class="vecy-add-cart-btn" type="button"
                                        onclick="vecyAddToCart(event, '{{ item.producto.pkid_prod }}', '{{ item.id_variante }}')">
                                    <i class="fas fa-cart-plus me-2"></i>
                                    Agregar
                                </button>
                                {% else %}
                                <button class="vecy-add-cart-btn" type="button"
                                        onclick="vecyAddToCart(event, '{{ item.producto.pkid_prod }}')">
                                    <i class="fas fa-cart-plus me-2"></i>
                                    Agregar
                                </button>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Overlay para área clickeable -->
                        <div class="vecy-clickable-overlay"></div>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
    </section>
    {% endif %}

    <!-- SECCIÓN DE ELECTRODOMÉSTICOS CON VARIANTES INDIVIDUALES -->
    {% if hay_electrodomesticos %}
    <section id="vecy-appliances" class="vecy-section vecy-appliances-section">
        <div class="container">
            <div class="vecy-section-header">
                <div class="vecy-header-content">
                    <div class="vecy-icon-header">
                        <i class="fas fa-blender"></i>
                    </div>
                    <div>
                        <h2 class="vecy-section-title">Electrodomésticos</h2>
                        <p class="vecy-section-subtitle">Los mejores electrodomésticos para tu hogar</p>
                    </div>
                </div>
                <a href="{% url 'productos_filtrados_logeado' %}?categoria=5" class="vecy-view-all">
                    Ver todos <i class="fas fa-arrow-right"></i>
                </a>
            </div>

            <div class="vecy-products-showcase">
                {% for item in electrodomesticos|slice:":8" %}
                <!-- ENLACE QUE CUBRE TODA LA TARJETA -->
                <a href="{% url 'producto_detalle_logeado' id=item.producto.pkid_prod %}" class="vecy-product-card-link" onclick="return vecyHandleCardClick(event, '{{ item.producto.pkid_prod }}')">
                    <div class="vecy-product-card vecy-appliance-card variant-card" data-aos="fade-up" data-aos-delay="{{ forloop.counter0|add:1 }}00">
                        {% if item.es_variante %}
                        <div class="vecy-variant-badge">
                            <i class="fas fa-star"></i> VARIANTE
                        </div>
                        {% endif %}
                        
                        <div class="vecy-product-media">
                            <div class="vecy-image-container">
                                {% if item.imagen %}
                                <img src="{{ item.imagen }}" alt="{{ item.nombre_completo }}" class="vecy-product-image">
                                {% else %}
                                <div class="vecy-image-placeholder">
                                    <i class="fas fa-blender"></i>
                                </div>
                                {% endif %}

                                <div class="vecy-product-overlay">
                                    <button class="vecy-quick-view" type="button" onclick="vecyQuickView(event, '{{ item.producto.pkid_prod }}')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="vecy-favorite-btn" type="button" onclick="vecyToggleFavorite(event, '{{ item.producto.pkid_prod }}', this)">
                                        <i class="far fa-heart"></i>
                                    </button>
                                </div>

                                {% if item.tiene_oferta %}
                                <div class="vecy-discount-ribbon">
                                    -{{ item.descuento_porcentaje|floatformat:0 }}%
                                </div>
                                {% endif %}
                            </div>

                            <div class="vecy-product-badges">
                                <span class="vecy-badge vecy-appliance-badge">
                                    <i class="fas fa-home me-1"></i>Hogar
                                </span>
                            </div>
                        </div>

                        <div class="vecy-product-content">
                            <h3 class="vecy-product-name">{{ item.nombre_completo }}</h3>

                            <div class="vecy-store-info">
                                <i class="fas fa-store"></i>
                                <span>{{ item.producto.fknegocioasociado_prod.nom_neg }}</span>
                            </div>

                            <div class="vecy-stock-info {% if item.stock < 10 %}vecy-low-stock{% endif %}">
                                <i class="fas fa-box"></i>
                                <span>{{ item.stock }} disponibles</span>
                            </div>

                            <div class="vecy-price-section">
                                <div class="vecy-price-main">
                                    <span class="vecy-current-price">${{ item.precio_final_formateado }}</span>
                                    {% if item.tiene_oferta %}
                                    <span class="vecy-original-price">${{ item.precio_base_formateado }}</span>
                                    {% endif %}
                                </div>
                                {% if item.tiene_oferta %}
                                <div class="vecy-savings-badge">
                                    -{{ item.descuento_porcentaje|floatformat:0 }}% • Ahorras ${{ item.ahorro_formateado }}
                                </div>
                                {% endif %}
                            </div>

                            <!-- ÁREA DE BOTONES - NO CLICKEABLE POR EL ENLACE -->
                            <div class="vecy-no-click-zone">
                                {% if item.id_variante %}
                                <button class="vecy-add-cart-btn" type="button"
                                        onclick="vecyAddToCart(event, '{{ item.producto.pkid_prod }}', '{{ item.id_variante }}')">
                                    <i class="fas fa-cart-plus me-2"></i>
                                    Agregar
                                </button>
                                {% else %}
                                <button class="vecy-add-cart-btn" type="button"
                                        onclick="vecyAddToCart(event, '{{ item.producto.pkid_prod }}')">
                                    <i class="fas fa-cart-plus me-2"></i>
                                    Agregar
                                </button>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Overlay para área clickeable -->
                        <div class="vecy-clickable-overlay"></div>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
    </section>
    {% endif %}

    <!-- PRODUCTOS BARATOS CON VARIANTES INDIVIDUALES -->
    <section id="vecy-budget" class="vecy-section vecy-gradient-bg-1">
        <div class="container">
            <div class="vecy-section-header">
                <div class="vecy-header-content">
                    <div class="vecy-icon-header">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div>
                        <h2 class="vecy-section-title">Productos Baratos</h2>
                        <p class="vecy-section-subtitle">Los mejores precios para tu economía diaria</p>
                    </div>
                </div>
                <a href="{% url 'productos_filtrados_logeado' %}?filtro=economicos" class="vecy-view-all">
                    Ver todos <i class="fas fa-arrow-right"></i>
                </a>
            </div>

            {% if productos_baratos %}
            <div class="vecy-products-showcase">
                {% for item in productos_baratos|slice:":12" %}
                <!-- ENLACE QUE CUBRE TODA LA TARJETA -->
                <a href="{% url 'producto_detalle_logeado' id=item.producto.pkid_prod %}" class="vecy-product-card-link" onclick="return vecyHandleCardClick(event, '{{ item.producto.pkid_prod }}')">
                    <div class="vecy-product-card variant-card" data-aos="fade-up" data-aos-delay="{{ forloop.counter0|add:1 }}00">
                        {% if item.es_variante %}
                        <div class="vecy-variant-badge">
                            <i class="fas fa-star"></i> VARIANTE
                        </div>
                        {% endif %}
                        
                        <div class="vecy-product-media">
                            <div class="vecy-image-container">
                                {% if item.imagen %}
                                <img src="{{ item.imagen }}" alt="{{ item.nombre_completo }}" class="vecy-product-image">
                                {% else %}
                                <div class="vecy-image-placeholder">
                                    <i class="fas fa-coins"></i>
                                </div>
                                {% endif %}

                                <div class="vecy-product-overlay">
                                    <button class="vecy-quick-view" type="button" onclick="vecyQuickView(event, '{{ item.producto.pkid_prod }}')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="vecy-favorite-btn" type="button" onclick="vecyToggleFavorite(event, '{{ item.producto.pkid_prod }}', this)">
                                        <i class="far fa-heart"></i>
                                    </button>
                                </div>

                                {% if item.tiene_oferta %}
                                <div class="vecy-discount-ribbon">
                                    -{{ item.descuento_porcentaje|floatformat:0 }}%
                                </div>
                                {% endif %}
                            </div>

                            <div class="vecy-product-badges">
                                <span class="vecy-badge vecy-budget-badge">
                                    <i class="fas fa-coins me-1"></i>Buen Precio
                                </span>
                            </div>
                        </div>

                        <div class="vecy-product-content">
                            <h3 class="vecy-product-name">{{ item.nombre_completo }}</h3>

                            <div class="vecy-store-info">
                                <i class="fas fa-store"></i>
                                <span>{{ item.producto.fknegocioasociado_prod.nom_neg }}</span>
                            </div>

                            <div class="vecy-stock-info {% if item.stock < 10 %}vecy-low-stock{% endif %}">
                                <i class="fas fa-box"></i>
                                <span>{{ item.stock }} disponibles</span>
                            </div>

                            <div class="vecy-price-section">
                                <div class="vecy-price-main">
                                    <span class="vecy-current-price">${{ item.precio_final_formateado }}</span>
                                    {% if item.tiene_oferta %}
                                    <span class="vecy-original-price">${{ item.precio_base_formateado }}</span>
                                    {% endif %}
                                </div>
                                {% if item.tiene_oferta %}
                                <div class="vecy-savings-badge">
                                    -{{ item.descuento_porcentaje|floatformat:0 }}% • Ahorras ${{ item.ahorro_formateado }}
                                </div>
                                {% endif %}
                            </div>

                            <!-- ÁREA DE BOTONES - NO CLICKEABLE POR EL ENLACE -->
                            <div class="vecy-no-click-zone">
                                {% if item.id_variante %}
                                <button class="vecy-add-cart-btn" type="button"
                                        onclick="vecyAddToCart(event, '{{ item.producto.pkid_prod }}', '{{ item.id_variante }}')">
                                    <i class="fas fa-cart-plus me-2"></i>
                                    Agregar
                                </button>
                                {% else %}
                                <button class="vecy-add-cart-btn" type="button"
                                        onclick="vecyAddToCart(event, '{{ item.producto.pkid_prod }}')">
                                    <i class="fas fa-cart-plus me-2"></i>
                                    Agregar
                                </button>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Overlay para área clickeable -->
                        <div class="vecy-clickable-overlay"></div>
                    </div>
                </a>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </section>

    <!-- SECCIÓN DE TECNOLOGÍA CON CARRUSEL ESPECIAL -->
    {% if hay_tecnologia %}
    <section id="vecy-technology" class="vecy-section vecy-technology-section">
        <div class="container">
            <div class="vecy-section-header">
                <div class="vecy-header-content">
                    <div class="vecy-icon-header">
                        <i class="fas fa-laptop"></i>
                    </div>
                    <div>
                        <h2 class="vecy-section-title">Tecnología</h2>
                        <p class="vecy-section-subtitle">Lo último en tecnología y electrónica</p>
                    </div>
                </div>
                <a href="{% url 'productos_filtrados_logeado' %}?categoria=3" class="vecy-view-all">
                    Ver todos <i class="fas fa-arrow-right"></i>
                </a>
            </div>

            <!-- CARRUSEL ESPECIAL PARA TECNOLOGÍA -->
            {% with tecnologia_con_ofertas=tecnologia|slice:":5" %}
            {% if tecnologia_con_ofertas %}
            <div class="vecy-tech-carousel-container mb-5">
                <div id="vecyTechCarousel" class="carousel slide vecy-tech-carousel" data-bs-ride="carousel">
                    <div class="carousel-indicators tech-indicators">
                        {% for item in tecnologia_con_ofertas %}
                            {% if item.tiene_oferta %}
                                <button type="button" data-bs-target="#vecyTechCarousel" data-bs-slide-to="{{ forloop.counter0 }}"
                                    {% if forloop.first %}class="active" {% endif %}></button>
                            {% endif %}
                        {% endfor %}
                    </div>

                    <div class="carousel-inner vecy-tech-inner">
                        {% for item in tecnologia_con_ofertas %}
                            {% if item.tiene_oferta %}
                            <div class="carousel-item vecy-tech-slide {% if forloop.first %}active{% endif %}">
                                <div class="vecy-tech-background">
                                    <img src="{% if item.imagen %}{{ item.imagen }}{% else %}https://images.unsplash.com/photo-1518709268805-4e9042af2176?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80{% endif %}"
                                        class="vecy-tech-image" alt="{{ item.nombre_completo }}">
                                    <div class="vecy-tech-overlay"></div>
                                </div>

                                <div class="vecy-tech-content">
                                    <div class="row align-items-center">
                                        <div class="col-lg-6" data-aos="fade-right">
                                            <div class="vecy-tech-badges">
                                                <span class="vecy-tech-badge">
                                                    <i class="fas fa-microchip me-2"></i>TECNOLOGÍA AVANZADA
                                                </span>
                                                <span class="vecy-tech-offer">
                                                    <i class="fas fa-bolt me-2"></i>Oferta Exclusiva
                                                </span>
                                            </div>

                                            <h3 class="vecy-tech-title">{{ item.nombre_completo }}</h3>
                                            <p class="vecy-tech-description">
                                                Tecnología de vanguardia con las mejores especificaciones del mercado. ¡No te quedes atrás!
                                            </p>

                                            <div class="vecy-tech-price">
                                                <div class="vecy-price-display tech">
                                                    <span class="vecy-final-price tech">${{ item.precio_final_formateado }}</span>
                                                    <span class="vecy-original-price tech">${{ item.precio_base_formateado }}</span>
                                                    <span class="vecy-discount-badge tech">
                                                        -{{ item.descuento_porcentaje|floatformat:0 }}% OFF
                                                    </span>
                                                </div>
                                                <div class="vecy-tech-savings">
                                                    <i class="fas fa-piggy-bank me-2"></i>
                                                    Ahorras ${{ item.ahorro_formateado }}
                                                </div>
                                            </div>

                                            <div class="vecy-tech-info">
                                                <div class="vecy-info-item tech">
                                                    <i class="fas fa-store"></i>
                                                    <span>{{ item.producto.fknegocioasociado_prod.nom_neg }}</span>
                                                </div>
                                                <div class="vecy-info-item tech">
                                                    <i class="fas fa-box"></i>
                                                    <span>{{ item.stock }} disponibles</span>
                                                </div>
                                                <div class="vecy-info-item tech">
                                                    <i class="fas fa-star"></i>
                                                    <span>Producto destacado</span>
                                                </div>
                                            </div>

                                            <div class="vecy-tech-actions">
                                                {% if item.id_variante %}
                                                <button class="vecy-tech-btn primary" 
                                                        onclick="addToCartWithSpecificVariant('{{ item.producto.pkid_prod }}', '{{ item.id_variante }}')">
                                                    <i class="fas fa-shopping-cart me-2"></i>
                                                    Añadir al Carrito
                                                </button>
                                                {% else %}
                                                <button class="vecy-tech-btn primary" 
                                                        onclick="addToCart('{{ item.producto.pkid_prod }}')">
                                                    <i class="fas fa-shopping-cart me-2"></i>
                                                    Añadir al Carrito
                                                </button>
                                                {% endif %}
                                                <button class="vecy-tech-btn secondary" onclick="toggleFavorite('{{ item.producto.pkid_prod }}', this)">
                                                    <i class="fas fa-heart me-2"></i>
                                                    Favorito
                                                </button>
                                            </div>
                                        </div>

                                        <div class="col-lg-6" data-aos="fade-left">
                                            <div class="vecy-tech-product-image">
                                                {% if item.imagen %}
                                                <img src="{{ item.imagen }}" alt="{{ item.nombre_completo }}" 
                                                     class="img-fluid tech-product-img">
                                                {% else %}
                                                <div class="vecy-tech-placeholder">
                                                    <i class="fas fa-laptop-code"></i>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        {% empty %}
                        <!-- SI NO HAY OFERTAS EN TECNOLOGÍA, MOSTRAR UN MENSAJE -->
                        <div class="carousel-item vecy-tech-slide active">
                            <div class="vecy-tech-background">
                                <img src="https://images.unsplash.com/photo-1518709268805-4e9042af2176?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80"
                                    class="vecy-tech-image" alt="Tecnología">
                                <div class="vecy-tech-overlay"></div>
                            </div>
                            <div class="vecy-tech-content">
                                <div class="row align-items-center">
                                    <div class="col-lg-12 text-center">
                                        <div class="vecy-tech-badges">
                                            <span class="vecy-tech-badge">
                                                <i class="fas fa-microchip me-2"></i>TECNOLOGÍA DE VANGUARDIA
                                            </span>
                                        </div>
                                        <h3 class="vecy-tech-title">Próximas Novedades Tecnológicas</h3>
                                        <p class="vecy-tech-description">
                                            Estamos preparando las últimas novedades en tecnología. ¡Vuelve pronto para descubrir los productos más innovadores!
                                        </p>
                                        <div class="vecy-tech-actions">
                                            <button class="vecy-tech-btn primary" onclick="window.location.href='{% url 'productos_filtrados_logeado' %}?categoria=1'">
                                                <i class="fas fa-shopping-bag me-2"></i>
                                                Explorar Tecnología
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <button class="carousel-control-prev vecy-tech-control" type="button"
                        data-bs-target="#vecyTechCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon tech" aria-hidden="true"></span>
                        <span class="visually-hidden">Anterior</span>
                    </button>
                    <button class="carousel-control-next vecy-tech-control" type="button"
                        data-bs-target="#vecyTechCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon tech" aria-hidden="true"></span>
                        <span class="visually-hidden">Siguiente</span>
                    </button>
                </div>
            </div>
            {% endif %}
            {% endwith %}

            <!-- GRILLA DE PRODUCTOS DE TECNOLOGÍA CON VARIANTES INDIVIDUALES -->
            <div class="vecy-products-showcase">
                {% for item in tecnologia|slice:":8" %}
                <!-- ENLACE QUE CUBRE TODA LA TARJETA -->
                <a href="{% url 'producto_detalle_logeado' id=item.producto.pkid_prod %}" class="vecy-product-card-link" onclick="return vecyHandleCardClick(event, '{{ item.producto.pkid_prod }}')">
                    <div class="vecy-product-card vecy-tech-card variant-card" data-aos="fade-up" data-aos-delay="{{ forloop.counter0|add:1 }}00">
                        {% if item.es_variante %}
                        <div class="vecy-variant-badge">
                            <i class="fas fa-star"></i> VARIANTE
                        </div>
                        {% endif %}
                        
                        <div class="vecy-product-media">
                            <div class="vecy-image-container">
                                {% if item.imagen %}
                                <img src="{{ item.imagen }}" alt="{{ item.nombre_completo }}" class="vecy-product-image">
                                {% else %}
                                <div class="vecy-image-placeholder">
                                    <i class="fas fa-laptop"></i>
                                </div>
                                {% endif %}

                                <div class="vecy-product-overlay">
                                    <button class="vecy-quick-view" type="button" onclick="vecyQuickView(event, '{{ item.producto.pkid_prod }}')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="vecy-favorite-btn" type="button" onclick="vecyToggleFavorite(event, '{{ item.producto.pkid_prod }}', this)">
                                        <i class="far fa-heart"></i>
                                    </button>
                                </div>

                                {% if item.tiene_oferta %}
                                <div class="vecy-discount-ribbon">
                                    -{{ item.descuento_porcentaje|floatformat:0 }}%
                                </div>
                                {% endif %}
                            </div>

                            <div class="vecy-product-badges">
                                <span class="vecy-badge vecy-tech-badge">
                                    <i class="fas fa-microchip me-1"></i>Tecnología
                                </span>
                                {% if item.tiene_oferta %}
                                <span class="vecy-badge vecy-offer-badge">
                                    <i class="fas fa-bolt me-1"></i>Oferta
                                </span>
                                {% endif %}
                            </div>
                        </div>

                        <div class="vecy-product-content">
                            <h3 class="vecy-product-name">{{ item.nombre_completo }}</h3>

                            <div class="vecy-store-info">
                                <i class="fas fa-store"></i>
                                <span>{{ item.producto.fknegocioasociado_prod.nom_neg }}</span>
                            </div>

                            <div class="vecy-stock-info {% if item.stock < 10 %}vecy-low-stock{% endif %}">
                                <i class="fas fa-box"></i>
                                <span>{{ item.stock }} disponibles</span>
                            </div>

                            <div class="vecy-price-section">
                                <div class="vecy-price-main">
                                    <span class="vecy-current-price">${{ item.precio_final_formateado }}</span>
                                    {% if item.tiene_oferta %}
                                    <span class="vecy-original-price">${{ item.precio_base_formateado }}</span>
                                    {% endif %}
                                </div>
                                {% if item.tiene_oferta %}
                                <div class="vecy-savings-badge">
                                    -{{ item.descuento_porcentaje|floatformat:0 }}% • Ahorras ${{ item.ahorro_formateado }}
                                </div>
                                {% endif %}
                            </div>

                            <!-- ÁREA DE BOTONES - NO CLICKEABLE POR EL ENLACE -->
                            <div class="vecy-no-click-zone">
                                {% if item.id_variante %}
                                <button class="vecy-add-cart-btn" type="button"
                                        onclick="vecyAddToCart(event, '{{ item.producto.pkid_prod }}', '{{ item.id_variante }}')">
                                    <i class="fas fa-cart-plus me-2"></i>
                                    Agregar
                                </button>
                                {% else %}
                                <button class="vecy-add-cart-btn" type="button"
                                        onclick="vecyAddToCart(event, '{{ item.producto.pkid_prod }}')">
                                    <i class="fas fa-cart-plus me-2"></i>
                                    Agregar
                                </button>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Overlay para área clickeable -->
                        <div class="vecy-clickable-overlay"></div>
                    </div>
                </a>
                {% endfor %}
            </div>

            {% if tecnologia|length > 8 %}
            <div class="vecy-show-more-container">
                <a href="{% url 'productos_filtrados_logeado' %}?categoria=1" class="vecy-show-more-btn">
                    Ver Más Tecnología <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            {% endif %}
        </div>
    </section>
    {% endif %}

    <!-- NEGOCIOS DESTACADOS -->
    <section id="vecy-businesses" class="vecy-section vecy-gradient-bg-4">
        <div class="container">
            <div class="vecy-section-header">
                <div class="vecy-header-content">
                    <div class="vecy-icon-header">
                        <i class="fas fa-store"></i>
                    </div>
                    <div>
                        <h2 class="vecy-section-title">Negocios Destacados</h2>
                        <p class="vecy-section-subtitle">Los mejores negocios con reseñas de 4-5 estrellas</p>
                    </div>
                </div>
                <a href="{% url 'productos_filtrados_logeado' %}?filtro=mas-vendidos" class="vecy-view-all">
                    Ver todos <i class="fas fa-arrow-right"></i>
                </a>
            </div>

            {% if negocios_destacados %}
            <div class="vecy-businesses-grid">
                {% for negocio_data in negocios_destacados|slice:":6" %}
                {% with negocio=negocio_data.negocio %}
                <div class="vecy-business-card" data-aos="fade-up" data-aos-delay="{{ forloop.counter0|add:1 }}00">
                    <div class="vecy-business-header">
                        <div class="vecy-business-image">
                            {% if negocio.img_neg %}
                            <img src="{{ negocio.img_neg.url }}" alt="{{ negocio.nom_neg }}" class="vecy-business-img">
                            {% else %}
                            <div class="vecy-business-placeholder">
                                <i class="fas fa-store"></i>
                            </div>
                            {% endif %}

                            <div class="vecy-rating-badge">
                                <i class="fas fa-star"></i>
                                {{ negocio_data.promedio_calificacion|floatformat:1 }}
                                <small>({{ negocio_data.total_resenas }})</small>
                            </div>
                        </div>
                    </div>

                    <div class="vecy-business-content">
                        <h3 class="vecy-business-name">{{ negocio.nom_neg }}</h3>
                        <p class="vecy-business-description">{{ negocio.desc_neg|default:"Negocio local comprometido con la calidad y el servicio"|truncatewords:15 }}</p>

                        <div class="vecy-business-info">
                            <div class="vecy-info-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>{{ negocio.direcc_neg|truncatewords:3 }}</span>
                            </div>
                            <div class="vecy-info-item">
                                <i class="fas fa-tag"></i>
                                <span>{{ negocio.fktiponeg_neg.desc_tiponeg }}</span>
                            </div>
                        </div>

                        <div class="vecy-business-stats">
                            <div class="vecy-stat">
                                <strong>{{ negocio_data.total_productos }}</strong>
                                <span>Productos</span>
                            </div>
                            <div class="vecy-stat">
                                <strong>{{ negocio_data.productos_en_oferta }}</strong>
                                <span>Ofertas</span>
                            </div>
                            <div class="vecy-stat">
                                <strong>{{ negocio_data.total_resenas }}</strong>
                                <span>Reseñas</span>
                            </div>
                        </div>

                        <a href="{% url 'detalle_negocio_logeado' id=negocio.pkid_neg %}" class="vecy-visit-btn">
                            <i class="fas fa-external-link-alt me-2"></i>
                            Visitar Tienda
                        </a>
                    </div>
                </div>
                {% endwith %}
                {% endfor %}
            </div>
            {% else %}
            <div class="vecy-empty-state">
                <div class="vecy-empty-icon">
                    <i class="fas fa-store-slash"></i>
                </div>
                <h3>Negocios Destacados</h3>
                <p>Pronto encontrarás aquí los negocios mejor calificados de tu localidad.</p>
            </div>
            {% endif %}
        </div>
    </section>

    <!-- OTROS NEGOCIOS ACTIVOS -->
    {% if otros_negocios %}
    <section id="vecy-other-businesses" class="vecy-section vecy-gradient-bg-5">
        <div class="container">
            <div class="vecy-section-header">
                <div class="vecy-header-content">
                    <div class="vecy-icon-header">
                        <i class="fas fa-store-alt"></i>
                    </div>
                    <div>
                        <h2 class="vecy-section-title">Más Negocios</h2>
                        <p class="vecy-section-subtitle">Descubre otros negocios activos en tu zona</p>
                    </div>
                </div>
                <a href="#" class="vecy-view-all">
                    Ver todos <i class="fas fa-arrow-right"></i>
                </a>
            </div>

            <div class="vecy-businesses-grid">
                {% for negocio_data in otros_negocios %}
                {% with negocio=negocio_data.negocio %}
                <div class="vecy-business-card" data-aos="fade-up" data-aos-delay="{{ forloop.counter0|add:1 }}00">
                    <div class="vecy-business-header">
                        <div class="vecy-business-image">
                            {% if negocio.img_neg %}
                            <img src="{{ negocio.img_neg.url }}" alt="{{ negocio.nom_neg }}" class="vecy-business-img">
                            {% else %}
                            <div class="vecy-business-placeholder">
                                <i class="fas fa-store"></i>
                            </div>
                            {% endif %}

                            <div class="vecy-rating-badge">
                                <i class="fas fa-star"></i>
                                {{ negocio_data.promedio_calificacion|floatformat:1 }}
                                <small>({{ negocio_data.total_resenas }})</small>
                            </div>
                        </div>
                    </div>

                    <div class="vecy-business-content">
                        <h3 class="vecy-business-name">{{ negocio.nom_neg }}</h3>
                        <p class="vecy-business-description">{{ negocio.desc_neg|default:"Negocio local comprometido con la calidad y el servicio"|truncatewords:15 }}</p>

                        <div class="vecy-business-info">
                            <div class="vecy-info-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>{{ negocio.direcc_neg|truncatewords:3 }}</span>
                            </div>
                            <div class="vecy-info-item">
                                <i class="fas fa-tag"></i>
                                <span>{{ negocio.fktiponeg_neg.desc_tiponeg }}</span>
                            </div>
                        </div>

                        <div class="vecy-business-stats">
                            <div class="vecy-stat">
                                <strong>{{ negocio_data.total_productos }}</strong>
                                <span>Productos</span>
                            </div>
                            <div class="vecy-stat">
                                <strong>{{ negocio_data.productos_en_oferta }}</strong>
                                <span>Ofertas</span>
                            </div>
                            <div class="vecy-stat">
                                <strong>{{ negocio_data.total_resenas }}</strong>
                                <span>Reseñas</span>
                            </div>
                        </div>

                        <a href="{% url 'detalle_negocio_logeado' id=negocio.pkid_neg %}" class="vecy-visit-btn">
                            <i class="fas fa-external-link-alt me-2"></i>
                            Visitar Tienda
                        </a>
                    </div>
                </div>
                {% endwith %}
                {% endfor %}
            </div>
        </div>
    </section>
    {% endif %}
</div>

{% include 'carrito_sistema.html' %}
{% endblock %}

{% block scripts %}
<!-- AOS JS -->
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
// ====================================================================
// SISTEMA UNIFICADO DE CARRITO - IDÉNTICO AL DE LA PÁGINA DE DETALLE
// ====================================================================

class VecyCarritoUnificado {
    constructor() {
        this.isProcessing = false;
        this.pendingRequests = [];
        this.debounceTime = 300; // ms para evitar múltiples clics
    }

    // ==================== MÉTODO PRINCIPAL - EXACTAMENTE IGUAL AL DE DETALLE ====================
    async agregarAlCarrito(productId, variantId = null, cantidad = 1, tipo = 'producto') {
        // Prevenir múltiples clics (debounce)
        if (this.isProcessing) {
            console.log('⏳ Solicitud en cola, procesando...');
            return this.encolarSolicitud(productId, variantId, cantidad, tipo);
        }

        this.isProcessing = true;
        
        // Obtener botón para feedback visual
        const boton = event ? event.target.closest('.vecy-add-cart-btn') : null;
        const originalText = boton ? boton.innerHTML : null;
        
        try {
            console.log(`🚀 [SISTEMA UNIFICADO] Agregando: Producto ${productId}, Variante ${variantId || 'base'}, Cantidad ${cantidad}`);
            
            // 1. USAR EXACTAMENTE EL MISMO SISTEMA QUE LA PÁGINA DE DETALLE
            if (window.vecyCarritoSystem && window.vecyCarritoSystem.addToCart) {
                // Feedback visual inmediato (igual que en detalle)
                if (boton) {
                    boton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Agregando...';
                    boton.disabled = true;
                }
                
                // LLAMADA IDÉNTICA A LA DE LA PÁGINA DE DETALLE
                const success = await window.vecyCarritoSystem.addToCart(
                    productId, 
                    variantId || 'base', 
                    cantidad
                );
                
                if (success) {
                    // CONFIRMACIÓN VISUAL IDÉNTICA A LA DE DETALLE
                    this.mostrarConfirmacionRapida(productId, tipo, boton);
                    
                    // El sistema global ya actualiza todo automáticamente
                    console.log('✅ Producto agregado usando sistema global unificado');
                    
                    return true;
                } else {
                    this.mostrarError('No se pudo agregar al carrito');
                    if (boton && originalText) boton.innerHTML = originalText;
                    return false;
                }
                
            } else {
                // 2. FALLBACK: LLAMADA DIRECTA A LA API (igual que en detalle)
                console.warn('⚠ Sistema global no disponible, usando API directa');
                return await this.llamadaDirectaAPI(productId, variantId, cantidad, boton);
            }
            
        } catch (error) {
            console.error('❌ Error en sistema unificado:', error);
            this.mostrarError('Error de conexión');
            if (boton && originalText) boton.innerHTML = originalText;
            return false;
        } finally {
            this.isProcessing = false;
            if (boton) boton.disabled = false;
            
            // Procesar solicitudes pendientes después de un breve delay
            setTimeout(() => this.procesarPendientes(), 500);
        }
    }

    // ==================== LLAMADA DIRECTA A API (FALLBACK) ====================
    async llamadaDirectaAPI(productId, variantId, cantidad, boton) {
        try {
            const csrftoken = this.getCookie('csrftoken');
            const payload = {
                producto_id: productId,
                cantidad: cantidad,
                variante_id: variantId && variantId !== 'base' ? variantId : null
            };
            
            console.log('📦 Payload API:', payload);
            
            const response = await fetch('{% url "agregar_carrito" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken
                },
                body: JSON.stringify(payload)
            });
            
            const data = await response.json();
            
            if (data.success) {
                this.mostrarConfirmacionRapida(productId, 'producto', boton);
                
                // Actualizar contadores manualmente
                this.actualizarContadorCarrito(data.carrito_count || 1);
                
                // Disparar evento para que el offcanvas se actualice
                document.dispatchEvent(new CustomEvent('cartCountUpdated', {
                    detail: data.carrito_count
                }));
                
                return true;
            } else {
                this.mostrarError(data.error || 'Error al agregar');
                return false;
            }
            
        } catch (error) {
            console.error('Error en API directa:', error);
            this.mostrarError('Error de conexión');
            return false;
        }
    }

    // ==================== AGREGAR COMBOS (SIN RECARGAR PÁGINA) ====================
    async agregarCombo(comboId) {
        console.log(`🎁 Agregando combo: ${comboId}`);
        
        // Obtener botón para feedback
        const boton = event ? event.target.closest('.vecy-combo-btn') : null;
        const originalText = boton ? boton.innerHTML : null;
        
        try {
            if (boton) {
                boton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Procesando...';
                boton.disabled = true;
            }
            
            const csrftoken = this.getCookie('csrftoken');
            const response = await fetch('{% url "agregar_combo_carrito" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken
                },
                body: JSON.stringify({
                    combo_id: comboId,
                    cantidad: 1
                })
            });
            
            const data = await response.json();
            
            if (data.success) {
                // CONFIRMACIÓN RÁPIDA (igual que productos normales)
                this.mostrarConfirmacionRapida(comboId, 'combo', boton);
                
                // Actualizar contadores usando el sistema global SIEMPRE
                if (window.vecyCarritoSystem && window.vecyCarritoSystem.updateAllCountsFromServer) {
                    await window.vecyCarritoSystem.updateAllCountsFromServer();
                }
                
                console.log('✅ Combo agregado exitosamente');
                
            } else {
                this.mostrarError(data.error || 'Error al agregar el combo');
            }
            
        } catch (error) {
            console.error('Error al agregar combo:', error);
            this.mostrarError('Error de conexión');
        } finally {
            if (boton) {
                if (originalText) boton.innerHTML = originalText;
                boton.disabled = false;
            }
        }
    }

    // ==================== AGREGAR PROMOCIONES 2x1 ====================
    async agregarPromocion2x1(promocionId) {
        console.log(`🎯 Agregando promoción 2x1: ${promocionId}`);
        
        const boton = event ? event.target.closest('.vecy-2x1-btn') : null;
        const originalText = boton ? boton.innerHTML : null;
        
        try {
            if (boton) {
                boton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Procesando...';
                boton.disabled = true;
            }
            
            const csrftoken = this.getCookie('csrftoken');
            const response = await fetch('{% url "agregar_promocion_2x1_carrito" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken
                },
                body: JSON.stringify({
                    promocion_id: promocionId,
                    cantidad: 1
                })
            });
            
            const data = await response.json();
            
            if (data.success) {
                this.mostrarConfirmacionRapida(promocionId, '2x1', boton);
                
                // Usar sistema global para actualizar
                if (window.vecyCarritoSystem && window.vecyCarritoSystem.updateAllCountsFromServer) {
                    await window.vecyCarritoSystem.updateAllCountsFromServer();
                }
                
            } else {
                this.mostrarError(data.error || 'Error al agregar la promoción');
            }
            
        } catch (error) {
            console.error('Error al agregar 2x1:', error);
            this.mostrarError('Error de conexión');
        } finally {
            if (boton) {
                if (originalText) boton.innerHTML = originalText;
                boton.disabled = false;
            }
        }
    }

    // ==================== FUNCIONES DE FAVORITOS (UNIFICADAS) ====================
    async alternarFavorito(productId, buttonElement) {
        if (!window.vecyCarritoSystem) {
            this.mostrarError('Sistema no disponible');
            return;
        }
        
        const esFavorito = buttonElement.querySelector('i.fas.fa-heart');
        const boton = buttonElement;
        const originalHTML = boton.innerHTML;
        
        try {
            // Feedback inmediato
            boton.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            boton.disabled = true;
            
            let success;
            
            if (esFavorito) {
                // Eliminar de favoritos
                success = await window.vecyCarritoSystem.eliminarFavorito(productId);
            } else {
                // Agregar a favoritos
                success = await window.vecyCarritoSystem.agregarFavorito(productId);
            }
            
            if (success) {
                const accion = esFavorito ? 'eliminado de' : 'agregado a';
                this.mostrarNotificacion(`Producto ${accion} favoritos`, 'success');
                
                // Actualizar icono visualmente
                this.actualizarIconoFavorito(boton, !esFavorito);
                
            } else {
                this.mostrarError('Error al actualizar favoritos');
                boton.innerHTML = originalHTML;
            }
            
        } catch (error) {
            console.error('Error en favoritos:', error);
            this.mostrarError('Error de conexión');
            boton.innerHTML = originalHTML;
        } finally {
            boton.disabled = false;
        }
    }

    // ==================== FUNCIONES AUXILIARES ====================
    mostrarConfirmacionRapida(id, tipo, boton) {
        // NOTIFICACIÓN SWEETALERT2 (igual que en detalle)
        this.mostrarNotificacion(
            tipo === 'combo' ? '🎁 Combo agregado al carrito' :
            tipo === '2x1' ? '🎯 Promoción 2x1 agregada' :
            '✅ Producto agregado al carrito',
            'success'
        );
        
        // ANIMACIÓN EN BOTÓN (igual que en detalle)
        if (boton) {
            const originalHTML = boton.innerHTML;
            const originalBg = boton.style.background;
            const originalColor = boton.style.color;
            
            boton.innerHTML = tipo === 'combo' ? 
                '<i class="fas fa-gift"></i> ¡Agregado!' :
                '<i class="fas fa-check"></i> ¡Agregado!';
            boton.style.background = 'var(--success)';
            boton.style.color = 'white';
            
            // Restaurar después de 2 segundos (igual que detalle)
            setTimeout(() => {
                boton.innerHTML = originalHTML;
                boton.style.background = originalBg;
                boton.style.color = originalColor;
            }, 2000);
        }
    }

    mostrarNotificacion(mensaje, tipo = 'info') {
        if (typeof Swal !== 'undefined') {
            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer);
                    toast.addEventListener('mouseleave', Swal.resumeTimer);
                }
            });

            Toast.fire({
                icon: tipo,
                title: mensaje
            });
        } else {
            console.log(`[${tipo.toUpperCase()}] ${mensaje}`);
        }
    }

    mostrarError(mensaje) {
        this.mostrarNotificacion(`❌ ${mensaje}`, 'error');
    }

    actualizarIconoFavorito(boton, esFavorito) {
        const icono = boton.querySelector('i');
        if (icono) {
            if (esFavorito) {
                icono.className = 'fas fa-heart';
                boton.classList.add('favorito-activo');
            } else {
                icono.className = 'far fa-heart';
                boton.classList.remove('favorito-activo');
            }
        }
    }

    actualizarContadorCarrito(count) {
        // Actualizar TODOS los contadores de carrito en la página
        const contadores = document.querySelectorAll(
            '.cart-count, .vecy-cart-count, #carrito-count, .carrito-count'
        );
        
        contadores.forEach(contador => {
            contador.textContent = count;
            contador.style.display = count > 0 ? 'inline-block' : 'none';
            
            // Animación de pulso (igual que en detalle)
            if (count > 0) {
                contador.classList.add('pulse-animation');
                setTimeout(() => contador.classList.remove('pulse-animation'), 600);
            }
        });
    }

    encolarSolicitud(productId, variantId, cantidad, tipo) {
        this.pendingRequests.push({ productId, variantId, cantidad, tipo });
        return false;
    }

    async procesarPendientes() {
        if (this.pendingRequests.length > 0 && !this.isProcessing) {
            const solicitud = this.pendingRequests.shift();
            await this.agregarAlCarrito(
                solicitud.productId, 
                solicitud.variantId, 
                solicitud.cantidad, 
                solicitud.tipo
            );
        }
    }

    getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
}

// ====================================================================
// INSTANCIA GLOBAL DEL SISTEMA UNIFICADO
// ====================================================================
window.vecyCarritoUnificado = new VecyCarritoUnificado();

// ====================================================================
// FUNCIONES DE INTERFAZ (MANTENER COMPATIBILIDAD)
// ====================================================================

// Función principal para agregar productos (usa el sistema unificado)
async function addToCart(productId) {
    event.preventDefault();
    event.stopPropagation();
    
    return await window.vecyCarritoUnificado.agregarAlCarrito(productId);
}

// Función para agregar productos con variante específica
async function addToCartWithSpecificVariant(productId, variantId) {
    event.preventDefault();
    event.stopPropagation();
    
    return await window.vecyCarritoUnificado.agregarAlCarrito(productId, variantId);
}

// Función para agregar combos
async function addComboToCart(comboId) {
    event.preventDefault();
    event.stopPropagation();
    
    return await window.vecyCarritoUnificado.agregarCombo(comboId);
}

// Función para agregar promociones 2x1
async function add2x1ToCart(promocionId) {
    event.preventDefault();
    event.stopPropagation();
    
    return await window.vecyCarritoUnificado.agregarPromocion2x1(promocionId);
}

// Función para alternar favoritos
async function toggleFavorite(productId, buttonElement) {
    event.preventDefault();
    event.stopPropagation();
    
    return await window.vecyCarritoUnificado.alternarFavorito(productId, buttonElement);
}

// Función para favoritos de combos
async function toggleFavoriteCombo(comboId, buttonElement) {
    event.preventDefault();
    event.stopPropagation();
    
    window.vecyCarritoUnificado.mostrarNotificacion('Función de favoritos para combos próximamente', 'info');
}

// ====================================================================
// FUNCIONES DE MANEJO DE CLICKS (PARA ENLACES DE TARJETAS)
// ====================================================================

function vecyHandleCardClick(event, productId) {
    const clickedElement = event.target;
    const esBoton = clickedElement.closest('.vecy-no-click-zone') || 
                   clickedElement.closest('button') ||
                   clickedElement.tagName === 'BUTTON' ||
                   clickedElement.closest('.vecy-add-cart-btn') ||
                   clickedElement.closest('.vecy-favorite-variant-btn') ||
                   clickedElement.closest('.vecy-quick-view') ||
                   clickedElement.closest('.vecy-favorite-btn') ||
                   clickedElement.closest('.vecy-combo-btn') ||
                   clickedElement.closest('.vecy-favorite-combo-btn') ||
                   clickedElement.closest('.vecy-2x1-btn') ||
                   clickedElement.closest('.vecy-favorite-2x1-btn');
    
    if (esBoton) {
        event.preventDefault();
        event.stopPropagation();
        return false;
    }
    
    return true;
}

// Versiones específicas para prevenir propagación
function vecyAddToCart(event, productId, variantId = null) {
    event.preventDefault();
    event.stopPropagation();
    
    if (variantId) {
        return addToCartWithSpecificVariant(productId, variantId);
    } else {
        return addToCart(productId);
    }
}

function vecyToggleFavorite(event, productId, buttonElement) {
    event.preventDefault();
    event.stopPropagation();
    return toggleFavorite(productId, buttonElement);
}

function vecyQuickView(event, productId) {
    event.preventDefault();
    event.stopPropagation();
    // Redirigir a detalle
    window.location.href = `/producto/${productId}/`;
}

// ====================================================================
// INICIALIZACIÓN Y CONFIGURACIÓN
// ====================================================================

function initAOS() {
    if (typeof AOS !== 'undefined') {
        AOS.init({ 
            duration: 800, 
            once: true, 
            offset: 100 
        });
    }
}

function initSmoothScroll() {
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }
        });
    });
}

// Conectar con el sistema global de carrito
function conectarSistemaGlobal() {
    console.log('🔗 Conectando con sistema global VecyCarritoSystem...');
    
    const intervalo = setInterval(() => {
        if (window.vecyCarritoSystem) {
            clearInterval(intervalo);
            console.log('✅ Conectado al sistema global');
            
            // Configurar listeners para eventos
            document.addEventListener('cartCountUpdated', (e) => {
                window.vecyCarritoUnificado.actualizarContadorCarrito(e.detail);
            });
            
            // Sincronizar contadores iniciales
            if (window.vecyCarritoSystem.getCarritoCount) {
                const count = window.vecyCarritoSystem.getCarritoCount();
                window.vecyCarritoUnificado.actualizarContadorCarrito(count);
            }
        }
    }, 100);
    
    // Timeout de seguridad
    setTimeout(() => {
        if (!window.vecyCarritoSystem) {
            console.warn('⚠ Sistema global no disponible después de 5 segundos');
        }
    }, 5000);
}

// Agregar estilos de animación
function agregarEstilosAnimacion() {
    const estilos = document.createElement('style');
    estilos.textContent = `
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        
        .pulse-animation {
            animation: pulse 0.6s ease-in-out;
        }
        
        .favorito-activo {
            color: #e74c3c !important;
        }
        
        .vecy-add-cart-btn:disabled,
        .vecy-combo-btn:disabled,
        .vecy-2x1-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .fa-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    `;
    document.head.appendChild(estilos);
}

// Prevenir clicks en botones dentro de enlaces
function prevenirClicksEnBotones() {
    document.addEventListener('click', function(e) {
        const botones = [
            '.vecy-add-cart-btn',
            '.vecy-favorite-variant-btn',
            '.vecy-quick-view',
            '.vecy-favorite-btn',
            '.vecy-combo-btn',
            '.vecy-favorite-combo-btn',
            '.vecy-2x1-btn',
            '.vecy-favorite-2x1-btn'
        ];
        
        botones.forEach(selector => {
            if (e.target.closest(selector)) {
                e.stopPropagation();
            }
        });
    });
}

// Inicialización completa
function initVecySistemaCompleto() {
    console.log('🚀 Iniciando sistema unificado Vecy...');
    
    // 1. Inicializar animaciones
    initAOS();
    initSmoothScroll();
    
    // 2. Agregar estilos
    agregarEstilosAnimacion();
    
    // 3. Conectar con sistema global
    conectarSistemaGlobal();
    
    // 4. Prevenir problemas de clicks
    prevenirClicksEnBotones();
    
    console.log('✅ Sistema unificado listo');
}

// Inicializar cuando el DOM esté listo
document.addEventListener('DOMContentLoaded', initVecySistemaCompleto);

// Inicializar también cuando la página cargue completamente
window.addEventListener('load', initVecySistemaCompleto);
</script>
{% endblock %}