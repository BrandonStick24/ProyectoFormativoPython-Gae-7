<!-- templates/Vendedor/Stock_V.html -->
{% extends 'Layout_V.html' %}
{% load static %}

{% block title %}Gesti√≥n de Stock - {{ negocio_activo.nom_neg }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header Mejorado con Estad√≠sticas -->
    <div class="tarjeta-bienvenida">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h2>Gesti√≥n de Stock</h2>
                <p class="text-muted">{{ negocio_activo.nom_neg }} - An√°lisis completo de inventario</p>
            </div>
            <div class="col-md-6">
                <div class="estadisticas-grid">
                    <div class="estadistica-card total">
                        <div class="estadistica-icono">
                            <i class="fas fa-cubes"></i>
                        </div>
                        <div class="estadistica-numero">{{ total_productos }}</div>
                        <div class="estadistica-titulo">Total Productos</div>
                    </div>
                    
                    <div class="estadistica-card disponibles">
                        <div class="estadistica-icono">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="estadistica-numero">{{ stock_normal }}</div>
                        <div class="estadistica-titulo">Stock Normal</div>
                    </div>
                    
                    <div class="estadistica-card oferta">
                        <div class="estadistica-icono">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="estadistica-numero">{{ stock_bajo }}</div>
                        <div class="estadistica-titulo">Stock Bajo</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mensajes -->
    {% if messages %}
    <div class="container-fluid mb-3">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            <i class="fas fa-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'warning' %}exclamation-triangle{% else %}info-circle{% endif %} me-2"></i>
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Barra de Herramientas Mejorada -->
    <div class="barra-herramientas">
        <div class="grupo-botones-accion">
            <a href="{% url 'Crud_V' %}" class="boton-accion boton-primario">
                <i class="fas fa-plus-circle"></i> Nuevo Producto
            </a>
            <button class="boton-accion boton-secundario" data-bs-toggle="modal" data-bs-target="#modalAjusteRapido">
                <i class="fas fa-bolt"></i> Ajuste R√°pido
            </button>
        </div>

        <div class="grupo-busqueda-filtros">
            <div class="contenedor-busqueda">
                <i class="fas fa-search icono-busqueda"></i>
                <input type="text" class="input-busqueda" id="filtro-stock" placeholder="Buscar productos...">
            </div>
            
            <div class="contenedor-filtros">
                <select class="select-filtro" id="filtro-estado-stock">
                    <option value="todos">Todos los productos</option>
                    <option value="normal">Stock Normal</option>
                    <option value="bajo">Stock Bajo</option>
                    <option value="critico">Sin Stock</option>
                </select>
            </div>
        </div>
    </div>

    <!-- M√©tricas Extendidas -->
    <div class="row g-3 mb-4">
        <div class="col-xl-2 col-md-4 col-6">
            <div class="metric-card-estilizada total">
                <div class="metric-content">
                    <div class="metric-icon">
                        <i class="fas fa-cubes"></i>
                    </div>
                    <div class="metric-info">
                        <div class="metric-value">{{ total_productos }}</div>
                        <div class="metric-label">Total Productos</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-2 col-md-4 col-6">
            <div class="metric-card-estilizada normal">
                <div class="metric-content">
                    <div class="metric-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="metric-info">
                        <div class="metric-value">{{ stock_normal }}</div>
                        <div class="metric-label">Stock Normal</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-2 col-md-4 col-6">
            <div class="metric-card-estilizada bajo">
                <div class="metric-content">
                    <div class="metric-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="metric-info">
                        <div class="metric-value">{{ stock_bajo }}</div>
                        <div class="metric-label">Stock Bajo</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-2 col-md-4 col-6">
            <div class="metric-card-estilizada critico">
                <div class="metric-content">
                    <div class="metric-icon">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="metric-info">
                        <div class="metric-value">{{ sin_stock }}</div>
                        <div class="metric-label">Sin Stock</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-2 col-md-4 col-6">
            <div class="metric-card-estilizada ofertas">
                <div class="metric-content">
                    <div class="metric-icon">
                        <i class="fas fa-tag"></i>
                    </div>
                    <div class="metric-info">
                        <div class="metric-value">{{ productos_oferta_count }}</div>
                        <div class="metric-label">En Oferta</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-2 col-md-4 col-6">
            <div class="metric-card-estilizada movimientos">
                <div class="metric-content">
                    <div class="metric-icon">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <div class="metric-info">
                        <div class="metric-value">{{ movimientos_hoy }}</div>
                        <div class="metric-label">Movimientos Hoy</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Alertas de Stock Bajo Mejoradas -->
    {% if productos_stock_bajo %}
    <div class="alerta-stock-bajo">
        <div class="alerta-header">
            <i class="fas fa-exclamation-triangle"></i>
            <h5>Productos que Necesitan Atenci√≥n</h5>
            <span class="badge-alerta">{{ productos_stock_bajo|length }}</span>
        </div>
        <div class="alerta-productos">
            {% for producto in productos_stock_bajo|slice:":8" %}
            <div class="producto-alerta">
                <div class="producto-info">
                    <span class="producto-nombre">{{ producto.nom_prod }}</span>
                    <span class="producto-categoria">{{ producto.fkcategoria_prod.desc_cp }}</span>
                </div>
                <div class="producto-stock">
                    <span class="stock-cantidad {% if producto.stock_prod == 0 %}stock-critico{% else %}stock-bajo{% endif %}">
                        {{ producto.stock_prod }} uds
                    </span>
                    <button class="btn-accion-rapida" 
                            data-bs-toggle="modal" 
                            data-bs-target="#modalEntradaStock"
                            data-producto-id="{{ producto.pkid_prod }}"
                            data-producto-nombre="{{ producto.nom_prod }}">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Contenido Principal -->
    <div class="row g-4">
        <!-- Columna Izquierda - Gr√°ficas y Tabla -->
        <div class="col-lg-8">
            <!-- Gr√°fica de Distribuci√≥n - BARRAS VERTICALES -->
            <div class="seccion-grafica">
                <div class="seccion-header">
                    <h3><i class="fas fa-chart-bar me-2"></i>Distribuci√≥n de Stock</h3>
                </div>
                <div class="contenedor-grafica">
                    <canvas id="stockChart"></canvas>
                </div>
            </div>

            <!-- Productos con Stock Bajo -->
            <div class="seccion-tabla">
                <div class="seccion-header">
                    <h3><i class="fas fa-list me-2"></i>Productos con Stock Bajo</h3>
                    <a href="{% url 'Crud_V' %}" class="btn btn-primario btn-sm">Gestionar Todos</a>
                </div>
                {% if productos_stock_bajo %}
                <div class="contenedor-tabla">
                    <table class="tabla-stock">
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>Categor√≠a</th>
                                <th>Stock Actual</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for producto in productos_stock_bajo %}
                            <tr class="producto-fila {% if producto.stock_prod == 0 %}fila-critica{% endif %}">
                                <td>
                                    <div class="producto-info-tabla">
                                        <strong>{{ producto.nom_prod }}</strong>
                                        {% if producto.pkid_prod in productos_en_oferta_ids %}
                                        <span class="badge-oferta-tabla">
                                            <i class="fas fa-tag"></i> Oferta
                                        </span>
                                        {% endif %}
                                    </div>
                                </td>
                                <td>
                                    <span class="categoria-tabla">{{ producto.fkcategoria_prod.desc_cp }}</span>
                                </td>
                                <td>
                                    <span class="stock-tabla {% if producto.stock_prod == 0 %}stock-critico{% else %}stock-bajo{% endif %}">
                                        {{ producto.stock_prod }} uds
                                    </span>
                                </td>
                                <td>
                                    <div class="estado-stock">
                                        {% if producto.stock_prod == 0 %}
                                        <i class="fas fa-times-circle estado-critico"></i>
                                        <span>Cr√≠tico</span>
                                        {% else %}
                                        <i class="fas fa-exclamation-triangle estado-bajo"></i>
                                        <span>Bajo</span>
                                        {% endif %}
                                    </div>
                                </td>
                                <td>
                                    <div class="acciones-tabla">
                                        <button class="btn-accion btn-entrada" 
                                                data-bs-toggle="modal" 
                                                data-bs-target="#modalEntradaStock"
                                                data-producto-id="{{ producto.pkid_prod }}"
                                                data-producto-nombre="{{ producto.nom_prod }}"
                                                title="Agregar Stock">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                        <a href="{% url 'Crud_V' %}" 
                                           class="btn-accion btn-editar" title="Editar Producto">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="estado-vacio">
                    <i class="fas fa-check-circle fa-3x"></i>
                    <h4>¬°Excelente! Stock Optimizado</h4>
                    <p>No hay productos con stock bajo en este momento</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Columna Derecha - Informaci√≥n -->
        <div class="col-lg-4">
            <!-- Movimientos Recientes - MEJORADO -->
            <div class="seccion-movimientos">
                <div class="seccion-header">
                    <h3><i class="fas fa-history me-2"></i>Movimientos Recientes</h3>
                    <!-- ‚úÖ CORREGIDO: Bot√≥n que lleva al reporte de movimientos -->
                    <a href="{% url 'reporte_movimientos_stock' %}" class="btn btn-secundario btn-sm">Ver Reportes</a>
                </div>
                <div class="contenedor-movimientos">
                    {% if movimientos_recientes %}
                        {% for movimiento in movimientos_recientes %}
                        <div class="movimiento-item {% if movimiento.tipo == 'eliminacion' %}movimiento-eliminacion{% elif movimiento.tipo == 'entrada' %}movimiento-entrada{% else %}movimiento-salida{% endif %}">
                            <div class="movimiento-header">
                                <span class="movimiento-producto">{{ movimiento.producto }}</span>
                                <span class="movimiento-cantidad {% if movimiento.tipo == 'entrada' %}entrada{% elif movimiento.tipo == 'eliminacion' %}eliminacion{% else %}salida{% endif %}">
                                    {% if movimiento.tipo == 'entrada' %}+{% elif movimiento.tipo == 'eliminacion' %}üóëÔ∏è{% else %}-{% endif %}{{ movimiento.cantidad }}
                                </span>
                            </div>
                            <div class="movimiento-detalle">
                                <span class="movimiento-motivo">{{ movimiento.motivo }}</span>
                                <span class="movimiento-fecha">{{ movimiento.fecha }}</span>
                            </div>
                            {% if movimiento.variante != 'Producto principal' %}
                            <div class="movimiento-variante">
                                <small class="text-muted">{{ movimiento.variante }}</small>
                            </div>
                            {% endif %}
                            {% if movimiento.usuario %}
                            <div class="movimiento-usuario">
                                <small class="text-muted">Por: {{ movimiento.usuario }}</small>
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    {% else %}
                    <div class="estado-vacio">
                        <i class="fas fa-inbox fa-2x"></i>
                        <p>No hay movimientos recientes</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Productos en Oferta -->
            <div class="seccion-ofertas">
                <div class="seccion-header">
                    <h3><i class="fas fa-tag me-2"></i>Productos en Oferta</h3>
                    <a href="{% url 'Ofertas_V' %}" class="btn btn-secundario btn-sm">Gestionar</a>
                </div>
                <div class="contenedor-ofertas">
                    {% if productos_oferta %}
                        {% for oferta in productos_oferta|slice:":4" %}
                        <div class="oferta-item">
                            <div class="oferta-info">
                                <h6>{{ oferta.producto_nombre }}</h6>
                                <div class="precios-oferta">
                                    <span class="precio-original">${{ oferta.precio_original|floatformat:0 }}</span>
                                    <span class="precio-actual">${{ oferta.precio_oferta|floatformat:0 }}</span>
                                </div>
                                <div class="oferta-meta">
                                    <span class="descuento">-{{ oferta.descuento|floatformat:0 }}%</span>
                                    <span class="stock-oferta">{{ oferta.stock_oferta }} uds</span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                    <div class="estado-vacio">
                        <i class="fas fa-tag fa-2x"></i>
                        <p>No hay ofertas activas</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Acciones R√°pidas -->
            <div class="seccion-acciones-rapidas">
                <div class="seccion-header">
                    <h3><i class="fas fa-bolt me-2"></i>Acciones R√°pidas</h3>
                </div>
                <div class="contenedor-acciones">
                    <a href="{% url 'Crud_V' %}" class="accion-rapida">
                        <i class="fas fa-plus-circle"></i>
                        <span>Nuevo Producto</span>
                    </a>
                    <a href="{% url 'Ofertas_V' %}" class="accion-rapida">
                        <i class="fas fa-tag"></i>
                        <span>Gestionar Ofertas</span>
                    </a>
                    <!-- ‚úÖ CORREGIDO: Bot√≥n que lleva al reporte de movimientos -->
                    <a href="{% url 'reporte_movimientos_stock' %}" class="accion-rapida">
                        <i class="fas fa-chart-bar"></i>
                        <span>Ver Reportes</span>
                    </a>
                    <button class="accion-rapida" data-bs-toggle="modal" data-bs-target="#modalAjusteRapido">
                        <i class="fas fa-exchange-alt"></i>
                        <span>Ajuste R√°pido</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Entrada Stock -->
<div class="modal fade" id="modalEntradaStock" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Entrada de Stock</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="{% url 'entrada_stock_producto' 0 %}" id="formEntradaStock">
                {% csrf_token %}
                <div class="modal-body">
                    <input type="hidden" id="producto_id_entrada" name="producto_id">
                    <div class="campo-modal">
                        <label class="etiqueta-campo">Producto</label>
                        <p class="valor-producto" id="nombre_producto_entrada"></p>
                    </div>
                    <div class="campo-modal">
                        <label class="etiqueta-campo">Cantidad *</label>
                        <input type="number" class="control-formulario" name="cantidad_entrada" min="1" required>
                    </div>
                    <div class="campo-modal">
                        <label class="etiqueta-campo">Motivo *</label>
                        <select class="control-formulario" name="motivo_entrada">
                            <option value="compra_proveedor">Compra a Proveedor</option>
                            <option value="devolucion_cliente">Devoluci√≥n de Cliente</option>
                            <option value="ajuste_inventario">Ajuste de Inventario</option>
                            <option value="otro">Otro</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secundario" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primario">Registrar Entrada</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal Ajuste R√°pido -->
<div class="modal fade" id="modalAjusteRapido" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Ajuste R√°pido de Stock</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="#">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="campo-modal">
                        <label class="etiqueta-campo">Producto *</label>
                        <select class="control-formulario" name="producto_id" required>
                            <option value="">Seleccionar producto...</option>
                            {% for producto in productos_stock_bajo %}
                            <option value="{{ producto.pkid_prod }}">{{ producto.nom_prod }} ({{ producto.stock_prod }} uds)</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="campo-modal">
                        <label class="etiqueta-campo">Tipo de Ajuste *</label>
                        <select class="control-formulario" name="tipo_ajuste">
                            <option value="entrada">Entrada (+)</option>
                            <option value="salida">Salida (-)</option>
                        </select>
                    </div>
                    <div class="campo-modal">
                        <label class="etiqueta-campo">Cantidad *</label>
                        <input type="number" class="control-formulario" name="cantidad" min="1" required>
                    </div>
                    <div class="campo-modal">
                        <label class="etiqueta-campo">Motivo *</label>
                        <input type="text" class="control-formulario" name="motivo" placeholder="Motivo del ajuste..." required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secundario" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primario">Aplicar Ajuste</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Gr√°fica de stock - BARRAS VERTICALES
    const ctx = document.getElementById('stockChart').getContext('2d');
    const stockChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Stock Normal', 'Stock Bajo', 'Sin Stock'],
            datasets: [{
                label: 'Cantidad de Productos',
                data: [{{ stock_normal }}, {{ stock_bajo }}, {{ sin_stock }}],
                backgroundColor: ['#10B981', '#F59E0B', '#EF4444'],
                borderColor: ['#059669', '#D97706', '#DC2626'],
                borderWidth: 1,
                borderRadius: 6,
                barPercentage: 0.6,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `${context.dataset.label}: ${context.parsed.y}`;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        display: true,
                        color: 'rgba(0, 0, 0, 0.05)'
                    },
                    ticks: {
                        font: {
                            size: 11
                        }
                    }
                },
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        font: {
                            size: 12,
                            weight: 'bold'
                        }
                    }
                }
            }
        }
    });

    // Modal de entrada de stock - CORREGIDO
    const modalEntrada = document.getElementById('modalEntradaStock');
    if (modalEntrada) {
        modalEntrada.addEventListener('show.bs.modal', function(event) {
            const button = event.relatedTarget;
            const productoId = button.getAttribute('data-producto-id');
            const productoNombre = button.getAttribute('data-producto-nombre');
            
            document.getElementById('producto_id_entrada').value = productoId;
            document.getElementById('nombre_producto_entrada').textContent = productoNombre;
            
            // Actualizar el action del formulario con el ID correcto
            const form = document.getElementById('formEntradaStock');
            form.action = "{% url 'entrada_stock_producto' 0 %}".replace('0', productoId);
        });
    }

    // Filtros de b√∫squeda
    const filtroStock = document.getElementById('filtro-stock');
    const filtroEstado = document.getElementById('filtro-estado-stock');
    
    function aplicarFiltrosStock() {
        const texto = filtroStock.value.toLowerCase();
        const estado = filtroEstado.value;
        
        // Aqu√≠ ir√≠a la l√≥gica de filtrado para la tabla
        console.log('Filtrando por:', texto, estado);
    }
    
    if (filtroStock) {
        filtroStock.addEventListener('input', aplicarFiltrosStock);
    }
    
    if (filtroEstado) {
        filtroEstado.addEventListener('change', aplicarFiltrosStock);
    }
});
</script>


<style>
/* Estilos generales mejorados basados en el dise√±o del CRUD */
:root {
    --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --secondary-gradient: linear-gradient(135deg, #4F46E5, #7C3AED);
    --success-gradient: linear-gradient(135deg, #10B981, #059669);
    --warning-gradient: linear-gradient(135deg, #F59E0B, #D97706);
    --danger-gradient: linear-gradient(135deg, #EF4444, #DC2626);
}

/* Tarjeta de Bienvenida */
.tarjeta-bienvenida {
    background: var(--primary-gradient);
    color: white;
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    margin-bottom: 2rem;
    position: relative;
    overflow: hidden;
}

.tarjeta-bienvenida::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 100%;
    height: 200%;
    background: rgba(255, 255, 255, 0.1);
    transform: rotate(30deg);
}

.tarjeta-bienvenida h2 {
    color: white;
    margin-bottom: 0.5rem;
    font-weight: 700;
    position: relative;
}

.tarjeta-bienvenida p {
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 0;
    position: relative;
}

/* Estad√≠sticas Grid */
.estadisticas-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    margin-top: 1rem;
}

.estadistica-card {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    padding: 1.5rem;
    border-radius: 15px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.estadistica-card:hover {
    transform: translateY(-5px);
    background: rgba(255, 255, 255, 0.25);
}

.estadistica-icono {
    font-size: 2rem;
    margin-bottom: 0.5rem;
    opacity: 0.9;
}

.estadistica-numero {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.25rem;
    color: white;
}

.estadistica-titulo {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.9);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Barra de Herramientas */
.barra-herramientas {
    background: white;
    padding: 1.5rem;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    margin-bottom: 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1.5rem;
}

.grupo-botones-accion {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.boton-accion {
    padding: 0.8rem 1.5rem;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 0.95rem;
    font-weight: 600;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    text-decoration: none;
}

.boton-primario {
    background: var(--secondary-gradient);
    color: white;
}

.boton-primario:hover {
    background: linear-gradient(135deg, #4338CA, #6D28D9);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4);
    color: white;
}

.boton-secundario {
    background: white;
    color: #4F46E5;
    border: 2px solid #4F46E5;
}

.boton-secundario:hover {
    background: #4F46E5;
    color: white;
    transform: translateY(-2px);
}

/* M√©tricas Estilizadas */
.metric-card-estilizada {
    background: white;
    border-radius: 12px;
    padding: 1.25rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    border-left: 4px solid;
    height: 100%;
}

.metric-card-estilizada:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.12);
}

.metric-card-estilizada.total { border-left-color: #4F46E5; }
.metric-card-estilizada.normal { border-left-color: #10B981; }
.metric-card-estilizada.bajo { border-left-color: #F59E0B; }
.metric-card-estilizada.critico { border-left-color: #EF4444; }
.metric-card-estilizada.ofertas { border-left-color: #8B5CF6; }
.metric-card-estilizada.movimientos { border-left-color: #0EA5E9; }

.metric-content {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.metric-icon {
    width: 50px;
    height: 50px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
}

.metric-card-estilizada.total .metric-icon { background: #EEF2FF; color: #4F46E5; }
.metric-card-estilizada.normal .metric-icon { background: #D1FAE5; color: #10B981; }
.metric-card-estilizada.bajo .metric-icon { background: #FEF3C7; color: #F59E0B; }
.metric-card-estilizada.critico .metric-icon { background: #FEE2E2; color: #EF4444; }
.metric-card-estilizada.ofertas .metric-icon { background: #F3E8FF; color: #8B5CF6; }
.metric-card-estilizada.movimientos .metric-icon { background: #E0F2FE; color: #0EA5E9; }

.metric-value {
    font-size: 1.8rem;
    font-weight: 700;
    line-height: 1;
    margin-bottom: 0.25rem;
}

.metric-label {
    font-size: 0.85rem;
    color: #6B7280;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Alertas de Stock Bajo */
.alerta-stock-bajo {
    background: #FFFBEB;
    border: 1px solid #FEF3C7;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 2rem;
}

.alerta-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
}

.alerta-header i {
    color: #F59E0B;
    font-size: 1.25rem;
}

.alerta-header h5 {
    color: #92400E;
    margin: 0;
    font-weight: 600;
}

.badge-alerta {
    background: #F59E0B;
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
}

.alerta-productos {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 0.75rem;
}

.producto-alerta {
    background: white;
    padding: 1rem;
    border-radius: 8px;
    border-left: 3px solid #F59E0B;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.2s ease;
}

.producto-alerta:hover {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.producto-info {
    flex: 1;
}

.producto-nombre {
    display: block;
    font-weight: 600;
    color: #1F2937;
    margin-bottom: 0.25rem;
}

.producto-categoria {
    font-size: 0.8rem;
    color: #6B7280;
}

.producto-stock {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.stock-cantidad {
    padding: 0.3rem 0.6rem;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: 600;
}

.stock-bajo {
    background: #FEF3C7;
    color: #92400E;
}

.stock-critico {
    background: #FEE2E2;
    color: #DC2626;
}

.btn-accion-rapida {
    width: 32px;
    height: 32px;
    border: none;
    border-radius: 8px;
    background: #4F46E5;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn-accion-rapida:hover {
    background: #4338CA;
    transform: scale(1.05);
}

/* Secciones */
.seccion-grafica,
.seccion-tabla,
.seccion-movimientos,
.seccion-ofertas,
.seccion-acciones-rapidas {
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    margin-bottom: 1.5rem;
    overflow: hidden;
}

.seccion-header {
    background: #F8FAFC;
    padding: 1.25rem 1.5rem;
    border-bottom: 1px solid #E5E7EB;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.seccion-header h3 {
    color: #1F2937;
    margin: 0;
    font-weight: 600;
    display: flex;
    align-items: center;
    font-size: 1.1rem;
}

/* Gr√°fica - TAMA√ëO OPTIMIZADO PARA PORT√ÅTILES */
.contenedor-grafica {
    padding: 1.5rem;
    height: 280px;
    position: relative;
}

/* Tabla */
.contenedor-tabla {
    padding: 0;
}

.tabla-stock {
    width: 100%;
    border-collapse: collapse;
}

.tabla-stock th {
    background: #F8FAFC;
    padding: 1rem 1.5rem;
    text-align: left;
    font-weight: 600;
    color: #374151;
    font-size: 0.9rem;
    border-bottom: 1px solid #E5E7EB;
}

.tabla-stock td {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid #F3F4F6;
}

.producto-fila:hover {
    background: #F9FAFB;
}

.fila-critica {
    background: #FEF2F2 !important;
}

.producto-info-tabla {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.badge-oferta-tabla {
    background: #8B5CF6;
    color: white;
    padding: 0.2rem 0.5rem;
    border-radius: 10px;
    font-size: 0.7rem;
    font-weight: 500;
    align-self: flex-start;
}

.categoria-tabla {
    color: #6B7280;
    font-size: 0.85rem;
}

.stock-tabla {
    padding: 0.4rem 0.8rem;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: 600;
}

.estado-stock {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
}

.estado-critico {
    color: #EF4444;
}

.estado-bajo {
    color: #F59E0B;
}

.acciones-tabla {
    display: flex;
    gap: 0.5rem;
}

.btn-accion {
    width: 32px;
    height: 32px;
    border: none;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.8rem;
}

.btn-entrada {
    background: #D1FAE5;
    color: #065F46;
}

.btn-entrada:hover {
    background: #10B981;
    color: white;
}

.btn-editar {
    background: #DBEAFE;
    color: #1E40AF;
}

.btn-editar:hover {
    background: #3B82F6;
    color: white;
}

/* Movimientos */
.contenedor-movimientos {
    padding: 1rem 1.5rem;
    max-height: 300px;
    overflow-y: auto;
}

.movimiento-item {
    background: #F8FAFC;
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 0.75rem;
    border-left: 3px solid;
    transition: all 0.2s ease;
}

.movimiento-item:hover {
    transform: translateX(2px);
}

.movimiento-entrada {
    border-left-color: #10B981;
}

.movimiento-salida {
    border-left-color: #EF4444;
}

.movimiento-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.movimiento-producto {
    font-weight: 600;
    color: #1F2937;
    font-size: 0.9rem;
}

.movimiento-cantidad {
    padding: 0.3rem 0.6rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
}

.movimiento-cantidad.entrada {
    background: #D1FAE5;
    color: #065F46;
}

.movimiento-cantidad.salida {
    background: #FEE2E2;
    color: #DC2626;
}

.movimiento-detalle {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.8rem;
    color: #6B7280;
}

/* Ofertas */
.contenedor-ofertas {
    padding: 1rem 1.5rem;
}

.oferta-item {
    background: #F8FAFC;
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 0.75rem;
    border-left: 3px solid #8B5CF6;
}

.oferta-item:last-child {
    margin-bottom: 0;
}

.oferta-info h6 {
    color: #1F2937;
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.precios-oferta {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}

.precio-original {
    text-decoration: line-through;
    color: #6B7280;
    font-size: 0.85rem;
}

.precio-actual {
    color: #EF4444;
    font-weight: 700;
    font-size: 1rem;
}

.oferta-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.8rem;
}

.descuento {
    background: #EF4444;
    color: white;
    padding: 0.2rem 0.5rem;
    border-radius: 10px;
    font-weight: 600;
}

.stock-oferta {
    color: #6B7280;
}

/* Acciones R√°pidas */
.contenedor-acciones {
    padding: 1rem 1.5rem;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.75rem;
}

.accion-rapida {
    background: white;
    border: 2px solid #E5E7EB;
    border-radius: 10px;
    padding: 1rem;
    text-decoration: none;
    color: #374151;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.2s ease;
    text-align: center;
}

.accion-rapida:hover {
    border-color: #4F46E5;
    color: #4F46E5;
    transform: translateY(-2px);
    text-decoration: none;
}

.accion-rapida i {
    font-size: 1.25rem;
}

.accion-rapida span {
    font-weight: 500;
    font-size: 0.85rem;
}

/* Estados Vac√≠o */
.estado-vacio {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    text-align: center;
    color: #6B7280;
}

.estado-vacio i {
    margin-bottom: 1rem;
    opacity: 0.5;
}

.estado-vacio h4 {
    color: #6B7280;
    margin-bottom: 0.5rem;
    font-size: 1.1rem;
}

.estado-vacio p {
    margin-bottom: 0;
    font-size: 0.9rem;
}

/* Modales */
.modal-content {
    border: none;
    border-radius: 15px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
}

.modal-header {
    background: #F8FAFC;
    border-bottom: 1px solid #E5E7EB;
    padding: 1.25rem 1.5rem;
}

.modal-title {
    font-weight: 600;
    color: #1F2937;
}

.campo-modal {
    margin-bottom: 1rem;
}

.etiqueta-campo {
    display: block;
    font-weight: 600;
    color: #374151;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
}

.control-formulario {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 2px solid #E5E7EB;
    border-radius: 8px;
    font-size: 0.9rem;
    transition: all 0.3s;
    background: white;
}

.control-formulario:focus {
    outline: none;
    border-color: #4F46E5;
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}

.valor-producto {
    background: #F8FAFC;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    font-weight: 600;
    color: #1F2937;
    margin: 0;
}

.modal-footer {
    border-top: 1px solid #E5E7EB;
    padding: 1.25rem 1.5rem;
}

.btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-primario {
    background: var(--secondary-gradient);
    color: white;
}

.btn-primario:hover {
    background: linear-gradient(135deg, #4338CA, #6D28D9);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
    color: white;
}

.btn-secundario {
    background: white;
    color: #6B7280;
    border: 1px solid #E5E7EB;
}

.btn-secundario:hover {
    background: #F3F4F6;
    border-color: #D1D5DB;
}

.btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.85rem;
}

.movimiento-eliminacion {
    border-left: 3px solid #DC2626;
    background: #FEF2F2;
}

.movimiento-cantidad.eliminacion {
    background: #DC2626;
    color: white;
}

.movimiento-eliminacion .movimiento-producto {
    color: #DC2626;
    font-weight: 600;
}

.movimiento-usuario {
    margin-top: 0.25rem;
    font-size: 0.75rem;
    color: #6B7280;
}

/* Optimizaciones para port√°tiles */
@media (max-width: 1400px) {
    .contenedor-grafica {
        height: 250px;
    }
    
    .metric-value {
        font-size: 1.6rem;
    }
    
    .metric-icon {
        width: 45px;
        height: 45px;
        font-size: 1.3rem;
    }
}

@media (max-width: 1200px) {
    .estadisticas-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .contenedor-grafica {
        height: 220px;
    }
}

@media (max-width: 992px) {
    .contenedor-grafica {
        height: 200px;
        padding: 1rem;
    }
    
    .seccion-header {
        padding: 1rem 1.25rem;
    }
    
    .tabla-stock th,
    .tabla-stock td {
        padding: 0.75rem 1rem;
    }
}

@media (max-width: 768px) {
    .estadisticas-grid {
        grid-template-columns: 1fr;
    }
    
    .barra-herramientas {
        flex-direction: column;
        align-items: stretch;
    }
    
    .grupo-botones-accion {
        flex-direction: column;
    }
    
    .boton-accion {
        width: 100%;
        justify-content: center;
    }
    
    .contenedor-busqueda {
        min-width: 100%;
    }
    
    .contenedor-filtros {
        width: 100%;
        justify-content: space-between;
    }
    
    .alerta-productos {
        grid-template-columns: 1fr;
    }
    
    .contenedor-acciones {
        grid-template-columns: 1fr;
    }
    
    .seccion-header {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
    }
    
    .tabla-stock {
        font-size: 0.8rem;
    }
    
    .contenedor-grafica {
        height: 180px;
    }
}

@media (max-width: 576px) {
    .tarjeta-bienvenida {
        padding: 1.5rem;
    }
    
    .metric-content {
        flex-direction: column;
        text-align: center;
        gap: 0.75rem;
    }
    
    .contenedor-grafica {
        height: 160px;
        padding: 0.75rem;
    }
}
</style>
{% endblock %}