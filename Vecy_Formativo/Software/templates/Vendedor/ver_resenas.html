{% extends 'Layout_V.html' %}
{% load static %}

{% block title %}Reseñas de Clientes{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header Mejorado con Estadísticas -->
    <div class="tarjeta-bienvenida">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h2>Reseñas de Clientes</h2>
                <p class="text-muted">Gestiona y responde a los comentarios de tus clientes.</p>
            </div>
            <div class="col-md-6">
                <div class="estadisticas-grid">
                    <div class="estadistica-card total">
                        <div class="estadistica-icono">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div class="estadistica-numero">{{ total_resenas }}</div>
                        <div class="estadistica-titulo">Total Reseñas</div>
                    </div>
                    
                    <div class="estadistica-card disponibles">
                        <div class="estadistica-icono">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="estadistica-numero">{{ promedio_estrellas }}/5</div>
                        <div class="estadistica-titulo">Calificación</div>
                    </div>
                    
                    <div class="estadistica-card oferta">
                        <div class="estadistica-icono">
                            <i class="fas fa-reply"></i>
                        </div>
                        <div class="estadistica-numero">{{ resenas_respondidas }}</div>
                        <div class="estadistica-titulo">Respondidas</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Barra de Herramientas Mejorada -->
    <div class="barra-herramientas">
        <div class="grupo-botones-accion">
            <button class="boton-accion boton-secundario" onclick="exportarResenas()">
                <i class="fas fa-download"></i> Exportar Reseñas
            </button>
        </div>

        <div class="grupo-busqueda-filtros">
            <div class="contenedor-busqueda">
                <i class="fas fa-search icono-busqueda"></i>
                <input type="text" class="input-busqueda" id="filtro-busqueda" placeholder="Buscar por cliente o comentario...">
            </div>
            
            <div class="contenedor-filtros">
                <select class="select-filtro" id="filtro-estado">
                    <option value="todas">Todas las reseñas</option>
                    <option value="respondidas">Respondidas</option>
                    <option value="sin-respuesta">Sin respuesta</option>
                </select>
                
                <select class="select-filtro" id="filtro-orden">
                    <option value="recientes">Más recientes</option>
                    <option value="antiguas">Más antiguas</option>
                    <option value="mejores">Mejor calificación</option>
                    <option value="peores">Peor calificación</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Layout Dividido Mejorado -->
    <div class="row g-4">
        <!-- Columna Izquierda: Lista de Reseñas -->
        <div class="col-lg-5">
            <div class="seccion-lista-resenas">
                <div class="seccion-header">
                    <h3><i class="fas fa-list me-2"></i>Lista de Reseñas</h3>
                    <span class="contador-seccion" id="contador-resenas">{{ total_resenas }}</span>
                </div>
                
                <div class="contenedor-lista-resenas">
                    {% if resenas %}
                        <div class="lista-resenas" id="lista-resenas">
                            {% for resena in resenas %}
                            <div class="resena-item {% if resena.tiene_respuesta %}resena-respondida{% endif %}" 
                                 data-index="{{ forloop.counter0 }}"
                                 data-estado="{% if resena.tiene_respuesta %}respondida{% else %}sin-respuesta{% endif %}"
                                 data-calificacion="{{ resena.calificacion }}"
                                 data-cliente="{{ resena.cliente|lower }}"
                                 data-fecha="{{ resena.fecha }}"
                                 onclick="mostrarResena({{ forloop.counter0 }})">
                                <div class="resena-header">
                                    <div class="resena-avatar">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="resena-info">
                                        <h5 class="resena-cliente">{{ resena.cliente }}</h5>
                                        <div class="resena-meta">
                                            <span class="resena-fecha">
                                                <i class="far fa-clock me-1"></i>{{ resena.fecha }}
                                            </span>
                                            <span class="resena-estado {% if resena.tiene_respuesta %}estado-respondida{% else %}estado-pendiente{% endif %}">
                                                {% if resena.tiene_respuesta %}
                                                    <i class="fas fa-check-circle me-1"></i>Respondida
                                                {% else %}
                                                    <i class="fas fa-clock me-1"></i>Sin respuesta
                                                {% endif %}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="resena-calificacion">
                                        <div class="estrellas-resena">
                                            {% for i in "12345" %}
                                                {% if forloop.counter <= resena.calificacion %}
                                                    <i class="fas fa-star"></i>
                                                {% else %}
                                                    <i class="far fa-star"></i>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                        <span class="puntuacion">{{ resena.calificacion }}/5</span>
                                    </div>
                                </div>
                                <div class="resena-comentario">
                                    <p>{{ resena.comentario|truncatewords:20 }}</p>
                                </div>
                            </div>
                            {% endfor %}
                        </div>

                        <!-- Paginación Mejorada -->
                        <div class="paginacion-resenas">
                            <div class="info-paginacion">
                                <span id="info-paginacion">Página 1 de {{ total_paginas }}</span>
                            </div>
                            <div class="controles-paginacion">
                                <button class="btn-paginacion" id="btn-prev" disabled>
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button class="btn-paginacion" id="btn-next">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    {% else %}
                        <div class="estado-vacio">
                            <i class="fas fa-comments fa-3x"></i>
                            <h4>Aún no tienes reseñas</h4>
                            <p>Los comentarios de tus clientes aparecerán aquí.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Columna Derecha: Detalle y Respuesta -->
        <div class="col-lg-7">
            <div class="seccion-detalle-resena">
                <div class="seccion-header">
                    <h3><i class="fas fa-comment-dots me-2"></i>Detalle de Reseña</h3>
                </div>
                
                <div class="contenedor-detalle-resena">
                    <div id="detalle-resena">
                        <div class="estado-vacio">
                            <i class="fas fa-mouse-pointer fa-2x"></i>
                            <h4>Selecciona una reseña</h4>
                            <p>Haz clic en una reseña de la lista para ver los detalles y responder</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Template para el detalle de reseña (oculto) -->
<div id="template-resena" style="display: none;">
    <div class="resena-detalle-completa">
        <!-- Header de la reseña -->
        <div class="resena-detalle-header">
            <div class="resena-info-completa">
                <div class="resena-avatar-grande">
                    <i class="fas fa-user"></i>
                </div>
                <div class="resena-datos">
                    <h4 id="detalle-cliente"></h4>
                    <div class="resena-detalle-meta">
                        <span class="fecha-detalle">
                            <i class="far fa-clock me-1"></i>
                            <span id="detalle-fecha"></span>
                        </span>
                        <span class="estado-detalle" id="estado-detalle"></span>
                    </div>
                </div>
            </div>
            <div class="resena-calificacion-detalle">
                <div class="estrellas-grandes" id="detalle-estrellas"></div>
                <span class="puntuacion-grande" id="detalle-calificacion"></span>
            </div>
        </div>

        <!-- Comentario del cliente -->
        <div class="seccion-comentario-cliente">
            <h5 class="titulo-seccion">
                <i class="fas fa-user-edit me-2"></i>
                Comentario del Cliente
            </h5>
            <div class="comentario-cliente">
                <p id="detalle-comentario"></p>
            </div>
        </div>

        <!-- Respuesta Existente -->
        <div class="seccion-respuesta-existente" id="respuesta-existente" style="display: none;">
            <h5 class="titulo-seccion text-success">
                <i class="fas fa-check-circle me-2"></i>
                Tu Respuesta
                <small class="fecha-respuesta" id="fecha-respuesta"></small>
            </h5>
            <div class="respuesta-actual">
                <p id="texto-respuesta"></p>
            </div>
        </div>

        <!-- Formulario de Respuesta -->
        <div class="seccion-formulario-respuesta">
            <form method="post" action="" id="form-respuesta" class="formulario-respuesta">
                {% csrf_token %}
                <h5 class="titulo-seccion">
                    <i class="fas fa-edit me-2"></i>
                    <span id="label-respuesta">Responder a esta reseña</span>
                </h5>
                
                <div class="campo-respuesta">
                    <textarea name="respuesta" class="input-respuesta" 
                              placeholder="Escribe tu respuesta profesional aquí..." 
                              rows="5" id="textarea-respuesta" required></textarea>
                    <div class="contador-caracteres">
                        <span id="contador-caracteres">0</span> caracteres
                    </div>
                </div>
                
                <div class="acciones-respuesta">
                    <button type="button" class="btn btn-secundario" onclick="limpiarRespuesta()">
                        <i class="fas fa-times me-1"></i> Cancelar
                    </button>
                    <button type="submit" class="btn btn-primario">
                        <i class="fas fa-paper-plane me-1"></i> 
                        <span id="texto-boton">Publicar Respuesta</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal de Exportación -->
<div class="modal fade" id="modalExportar" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Exportar Reseñas</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Selecciona el formato de exportación:</p>
                <div class="formatos-exportacion">
                    <button class="btn-formato" onclick="exportarPDF()">
                        <i class="fas fa-file-pdf"></i>
                        <span>PDF</span>
                    </button>
                    <button class="btn-formato" onclick="exportarExcel()">
                        <i class="fas fa-file-excel"></i>
                        <span>Excel</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Datos de las reseñas para JavaScript
const resenasData = [
    {% for resena in resenas %}
    {
        id: {{ resena.id }},
        cliente: "{{ resena.cliente|escapejs }}",
        fecha: "{{ resena.fecha }}",
        calificacion: {{ resena.calificacion }},
        comentario: `{{ resena.comentario|escapejs }}`,
        respuesta: `{{ resena.respuesta|escapejs }}`,
        tiene_respuesta: {{ resena.tiene_respuesta|yesno:"true,false" }},
        fecha_respuesta: "{{ resena.fecha_respuesta }}",
        url_responder: "{% url 'responder_resena' resena.id %}"
    },
    {% endfor %}
];

// Variables para paginación y filtros
let resenasFiltradas = [...resenasData];
let paginaActual = 1;
const reseñasPorPagina = 5;
let resenaSeleccionada = null;

// Función para mostrar reseña en el detalle
function mostrarResena(index) {
    if (index < 0 || index >= resenasFiltradas.length) return;
    
    resenaSeleccionada = resenasFiltradas[index];
    const template = document.getElementById('template-resena').innerHTML;
    const detalleDiv = document.getElementById('detalle-resena');
    
    detalleDiv.innerHTML = template;
    
    // Llenar datos básicos
    document.getElementById('detalle-cliente').textContent = resenaSeleccionada.cliente;
    document.getElementById('detalle-fecha').textContent = resenaSeleccionada.fecha;
    document.getElementById('detalle-comentario').textContent = resenaSeleccionada.comentario;
    
    // Estrellas
    let estrellasHtml = '';
    for (let i = 1; i <= 5; i++) {
        if (i <= resenaSeleccionada.calificacion) {
            estrellasHtml += '<i class="fas fa-star"></i>';
        } else {
            estrellasHtml += '<i class="far fa-star"></i>';
        }
    }
    document.getElementById('detalle-estrellas').innerHTML = estrellasHtml;
    document.getElementById('detalle-calificacion').textContent = `${resenaSeleccionada.calificacion}/5`;
    
    // Estado
    const estadoDetalle = document.getElementById('estado-detalle');
    if (resenaSeleccionada.tiene_respuesta) {
        estadoDetalle.innerHTML = '<i class="fas fa-check-circle me-1"></i>Respondida';
        estadoDetalle.className = 'estado-detalle estado-respondida';
    } else {
        estadoDetalle.innerHTML = '<i class="fas fa-clock me-1"></i>Sin respuesta';
        estadoDetalle.className = 'estado-detalle estado-pendiente';
    }
    
    // Configurar respuesta existente
    const respuestaDiv = document.getElementById('respuesta-existente');
    const form = document.getElementById('form-respuesta');
    const textarea = document.getElementById('textarea-respuesta');
    const contadorCaracteres = document.getElementById('contador-caracteres');
    
    if (resenaSeleccionada.tiene_respuesta) {
        respuestaDiv.style.display = 'block';
        document.getElementById('texto-respuesta').textContent = resenaSeleccionada.respuesta;
        document.getElementById('fecha-respuesta').textContent = resenaSeleccionada.fecha_respuesta ? 
            ` - ${resenaSeleccionada.fecha_respuesta}` : '';
        
        // Cambiar texto del formulario para edición
        document.getElementById('label-respuesta').textContent = 'Editar tu respuesta';
        document.getElementById('texto-boton').textContent = 'Actualizar Respuesta';
        textarea.value = resenaSeleccionada.respuesta;
    } else {
        respuestaDiv.style.display = 'none';
        document.getElementById('label-respuesta').textContent = 'Responder a esta reseña';
        document.getElementById('texto-boton').textContent = 'Publicar Respuesta';
        textarea.value = '';
    }
    
    // Actualizar action del formulario
    form.action = resenaSeleccionada.url_responder;
    
    // Actualizar contador de caracteres
    contadorCaracteres.textContent = textarea.value.length;
    
    // Configurar evento para contador de caracteres
    textarea.addEventListener('input', function() {
        contadorCaracteres.textContent = this.value.length;
    });
    
    // Resaltar item seleccionado
    document.querySelectorAll('.resena-item').forEach(item => {
        item.classList.remove('activa');
    });
    
    // Encontrar y resaltar el item correcto en la lista filtrada
    const items = document.querySelectorAll('.resena-item');
    for (let i = 0; i < items.length; i++) {
        if (parseInt(items[i].dataset.index) === index) {
            items[i].classList.add('activa');
            break;
        }
    }
    
    // Scroll suave al detalle en móvil
    if (window.innerWidth < 992) {
        document.querySelector('.seccion-detalle-resena').scrollIntoView({ 
            behavior: 'smooth' 
        });
    }
}

// Función para aplicar filtros
function aplicarFiltros() {
    const filtroEstado = document.getElementById('filtro-estado').value;
    const filtroOrden = document.getElementById('filtro-orden').value;
    const filtroBusqueda = document.getElementById('filtro-busqueda').value.toLowerCase();
    
    // Filtrar por estado
    resenasFiltradas = resenasData.filter(resena => {
        let cumpleEstado = true;
        let cumpleBusqueda = true;
        
        // Filtro por estado (respondida/sin respuesta)
        if (filtroEstado === 'respondidas') {
            cumpleEstado = resena.tiene_respuesta;
        } else if (filtroEstado === 'sin-respuesta') {
            cumpleEstado = !resena.tiene_respuesta;
        }
        
        // Filtro por búsqueda
        if (filtroBusqueda) {
            cumpleBusqueda = resena.cliente.toLowerCase().includes(filtroBusqueda) || 
                            resena.comentario.toLowerCase().includes(filtroBusqueda);
        }
        
        return cumpleEstado && cumpleBusqueda;
    });
    
    // Ordenar
    switch (filtroOrden) {
        case 'antiguas':
            resenasFiltradas.sort((a, b) => new Date(a.fecha) - new Date(b.fecha));
            break;
        case 'mejores':
            resenasFiltradas.sort((a, b) => b.calificacion - a.calificacion);
            break;
        case 'peores':
            resenasFiltradas.sort((a, b) => a.calificacion - b.calificacion);
            break;
        default: // recientes
            resenasFiltradas.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
    }
    
    // Resetear a página 1
    paginaActual = 1;
    actualizarListaResenas();
}

// Función para actualizar la lista visual
function actualizarListaResenas() {
    const lista = document.getElementById('lista-resenas');
    const contador = document.getElementById('contador-resenas');
    const infoPaginacion = document.getElementById('info-paginacion');
    
    if (!lista) return;
    
    // Calcular índices para paginación
    const inicio = (paginaActual - 1) * reseñasPorPagina;
    const fin = inicio + reseñasPorPagina;
    const resenasPagina = resenasFiltradas.slice(inicio, fin);
    
    // Actualizar lista
    lista.innerHTML = '';
    resenasPagina.forEach((resena, index) => {
        const indexGlobal = resenasFiltradas.indexOf(resena);
        const item = document.createElement('div');
        item.className = `resena-item ${resena.tiene_respuesta ? 'resena-respondida' : ''}`;
        item.setAttribute('data-index', indexGlobal);
        item.setAttribute('data-estado', resena.tiene_respuesta ? 'respondida' : 'sin-respuesta');
        item.setAttribute('data-calificacion', resena.calificacion);
        item.setAttribute('data-cliente', resena.cliente.toLowerCase());
        item.setAttribute('data-fecha', resena.fecha);
        item.onclick = () => mostrarResena(indexGlobal);
        
        let estrellasHtml = '';
        for (let i = 1; i <= 5; i++) {
            estrellasHtml += i <= resena.calificacion ? 
                '<i class="fas fa-star"></i>' : '<i class="far fa-star"></i>';
        }
        
        item.innerHTML = `
            <div class="resena-header">
                <div class="resena-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="resena-info">
                    <h5 class="resena-cliente">${resena.cliente}</h5>
                    <div class="resena-meta">
                        <span class="resena-fecha">
                            <i class="far fa-clock me-1"></i>${resena.fecha}
                        </span>
                        <span class="resena-estado ${resena.tiene_respuesta ? 'estado-respondida' : 'estado-pendiente'}">
                            ${resena.tiene_respuesta ? 
                                '<i class="fas fa-check-circle me-1"></i>Respondida' : 
                                '<i class="fas fa-clock me-1"></i>Sin respuesta'}
                        </span>
                    </div>
                </div>
                <div class="resena-calificacion">
                    <div class="estrellas-resena">${estrellasHtml}</div>
                    <span class="puntuacion">${resena.calificacion}/5</span>
                </div>
            </div>
            <div class="resena-comentario">
                <p>${resena.comentario.substring(0, 100)}${resena.comentario.length > 100 ? '...' : ''}</p>
            </div>
        `;
        
        lista.appendChild(item);
    });
    
    // Actualizar contadores
    contador.textContent = resenasFiltradas.length;
    
    const totalPaginas = Math.ceil(resenasFiltradas.length / reseñasPorPagina);
    infoPaginacion.textContent = `Página ${paginaActual} de ${totalPaginas}`;
    
    // Actualizar botones de paginación
    document.getElementById('btn-prev').disabled = paginaActual === 1;
    document.getElementById('btn-next').disabled = paginaActual === totalPaginas || totalPaginas === 0;
    
    // Mostrar primera reseña si existe
    if (resenasPagina.length > 0) {
        mostrarResena(resenasFiltradas.indexOf(resenasPagina[0]));
    } else {
        document.getElementById('detalle-resena').innerHTML = `
            <div class="estado-vacio">
                <i class="fas fa-search fa-2x"></i>
                <h4>No hay reseñas que coincidan</h4>
                <p>No se encontraron reseñas con los filtros aplicados</p>
            </div>
        `;
    }
}

// Función para limpiar respuesta
function limpiarRespuesta() {
    const textarea = document.getElementById('textarea-respuesta');
    const contador = document.getElementById('contador-caracteres');
    
    if (textarea) {
        textarea.value = '';
        contador.textContent = '0';
    }
}

// Funciones de exportación
function exportarResenas() {
    const modal = new bootstrap.Modal(document.getElementById('modalExportar'));
    modal.show();
}

function exportarPDF() {
    mostrarNotificacion('Preparando exportación en PDF...', 'info');
    // Aquí iría la lógica real de exportación PDF
}

function exportarExcel() {
    mostrarNotificacion('Preparando exportación en Excel...', 'info');
    // Aquí iría la lógica real de exportación Excel
}

// Función para mostrar notificaciones
function mostrarNotificacion(mensaje, tipo = 'info') {
    const alertClass = {
        'success': 'alert-success',
        'error': 'alert-danger',
        'warning': 'alert-warning',
        'info': 'alert-info'
    }[tipo] || 'alert-info';

    const iconClass = {
        'success': 'fa-check-circle',
        'error': 'fa-exclamation-circle',
        'warning': 'fa-exclamation-triangle',
        'info': 'fa-info-circle'
    }[tipo] || 'fa-info-circle';

    const notificacionHTML = `
        <div class="alert ${alertClass} alert-dismissible fade show notificacion-temporal" role="alert" 
             style="position: fixed; top: 100px; right: 20px; z-index: 1060; min-width: 300px;">
            <i class="fas ${iconClass} me-2"></i>
            ${mensaje}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', notificacionHTML);
    
    // Auto-eliminar después de 4 segundos
    setTimeout(() => {
        const alert = document.querySelector('.notificacion-temporal');
        if (alert) {
            alert.remove();
        }
    }, 4000);
}

// Event Listeners para filtros
document.addEventListener('DOMContentLoaded', function() {
    // Inicializar
    if (resenasData.length > 0) {
        aplicarFiltros();
    }
    
    // Configurar event listeners para filtros
    document.getElementById('filtro-estado').addEventListener('change', aplicarFiltros);
    document.getElementById('filtro-orden').addEventListener('change', aplicarFiltros);
    document.getElementById('filtro-busqueda').addEventListener('input', aplicarFiltros);
    
    // Configurar paginación
    document.getElementById('btn-prev').addEventListener('click', function() {
        if (paginaActual > 1) {
            paginaActual--;
            actualizarListaResenas();
        }
    });
    
    document.getElementById('btn-next').addEventListener('click', function() {
        const totalPaginas = Math.ceil(resenasFiltradas.length / reseñasPorPagina);
        if (paginaActual < totalPaginas) {
            paginaActual++;
            actualizarListaResenas();
        }
    });
    
    // Auto-focus en búsqueda
    document.getElementById('filtro-busqueda').focus();
});
</script>

<style>
/* Estilos generales mejorados basados en el diseño del CRUD */
:root {
    --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --secondary-gradient: linear-gradient(135deg, #4F46E5, #7C3AED);
    --success-gradient: linear-gradient(135deg, #10B981, #059669);
    --warning-gradient: linear-gradient(135deg, #F59E0B, #D97706);
    --danger-gradient: linear-gradient(135deg, #EF4444, #DC2626);
}

/* Tarjeta de Bienvenida */
.tarjeta-bienvenida {
    background: var(--primary-gradient);
    color: white;
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    margin-bottom: 2rem;
    position: relative;
    overflow: hidden;
}

.tarjeta-bienvenida::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 100%;
    height: 200%;
    background: rgba(255, 255, 255, 0.1);
    transform: rotate(30deg);
}

.tarjeta-bienvenida h2 {
    color: white;
    margin-bottom: 0.5rem;
    font-weight: 700;
    position: relative;
}

.tarjeta-bienvenida p {
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 0;
    position: relative;
}

/* Estadísticas Grid */
.estadisticas-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    margin-top: 1rem;
}

.estadistica-card {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    padding: 1.5rem;
    border-radius: 15px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.estadistica-card:hover {
    transform: translateY(-5px);
    background: rgba(255, 255, 255, 0.25);
}

.estadistica-icono {
    font-size: 2rem;
    margin-bottom: 0.5rem;
    opacity: 0.9;
}

.estadistica-numero {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.25rem;
    color: white;
}

.estadistica-titulo {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.9);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Barra de Herramientas */
.barra-herramientas {
    background: white;
    padding: 1.5rem;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    margin-bottom: 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1.5rem;
}

.grupo-botones-accion {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.boton-accion {
    padding: 0.8rem 1.5rem;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 0.95rem;
    font-weight: 600;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    text-decoration: none;
}

.boton-primario {
    background: var(--secondary-gradient);
    color: white;
}

.boton-primario:hover {
    background: linear-gradient(135deg, #4338CA, #6D28D9);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4);
    color: white;
}

.boton-secundario {
    background: white;
    color: #4F46E5;
    border: 2px solid #4F46E5;
}

.boton-secundario:hover {
    background: #4F46E5;
    color: white;
    transform: translateY(-2px);
}

/* Filtros y Búsqueda */
.grupo-busqueda-filtros {
    display: flex;
    gap: 1rem;
    align-items: center;
    flex-wrap: wrap;
}

.contenedor-busqueda {
    position: relative;
    min-width: 300px;
}

.icono-busqueda {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: #6B7280;
    z-index: 2;
}

.input-busqueda {
    width: 100%;
    padding: 0.8rem 1rem 0.8rem 2.5rem;
    border: 2px solid #E5E7EB;
    border-radius: 10px;
    font-size: 0.95rem;
    transition: all 0.3s;
    background: white;
}

.input-busqueda:focus {
    outline: none;
    border-color: #4F46E5;
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}

.contenedor-filtros {
    display: flex;
    gap: 1rem;
    align-items: center;
}

.select-filtro {
    padding: 0.8rem 1rem;
    border: 2px solid #E5E7EB;
    border-radius: 10px;
    font-size: 0.95rem;
    cursor: pointer;
    background: white;
    transition: all 0.3s;
    min-width: 150px;
}

.select-filtro:focus {
    outline: none;
    border-color: #4F46E5;
}

/* Secciones */
.seccion-lista-resenas,
.seccion-detalle-resena {
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    height: fit-content;
    max-height: 80vh;
}

.seccion-header {
    background: #F8FAFC;
    padding: 1.5rem;
    border-bottom: 1px solid #E5E7EB;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.seccion-header h3 {
    color: #1F2937;
    margin: 0;
    font-weight: 600;
    display: flex;
    align-items: center;
}

.contador-seccion {
    background: var(--secondary-gradient);
    color: white;
    padding: 0.4rem 0.8rem;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 600;
}

/* Lista de Reseñas */
.contenedor-lista-resenas {
    padding: 0;
    max-height: 60vh;
    overflow-y: auto;
}

.lista-resenas {
    display: flex;
    flex-direction: column;
}

.resena-item {
    padding: 1.25rem;
    border-bottom: 1px solid #F3F4F6;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    border-left: 4px solid transparent;
}

.resena-item:hover {
    background: #F9FAFB;
    transform: translateX(2px);
}

.resena-item.activa {
    background: #4F46E5;
    color: white;
    border-left-color: #4F46E5;
}

.resena-item.activa .resena-cliente,
.resena-item.activa .resena-fecha,
.resena-item.activa .resena-comentario p {
    color: white;
}

.resena-item.activa .resena-estado {
    background: rgba(255, 255, 255, 0.2);
    color: white;
}

.resena-respondida {
    border-left-color: #10B981;
}

.resena-header {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    margin-bottom: 0.75rem;
}

.resena-avatar {
    width: 40px;
    height: 40px;
    background: #E5E7EB;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #6B7280;
    flex-shrink: 0;
}

.resena-item.activa .resena-avatar {
    background: rgba(255, 255, 255, 0.2);
    color: white;
}

.resena-info {
    flex: 1;
}

.resena-cliente {
    font-weight: 600;
    color: #1F2937;
    margin-bottom: 0.25rem;
    font-size: 1rem;
}

.resena-meta {
    display: flex;
    gap: 1rem;
    align-items: center;
    flex-wrap: wrap;
}

.resena-fecha {
    font-size: 0.8rem;
    color: #6B7280;
}

.resena-estado {
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 500;
}

.estado-respondida {
    background: #D1FAE5;
    color: #065F46;
}

.estado-pendiente {
    background: #FEF3C7;
    color: #92400E;
}

.resena-calificacion {
    text-align: right;
    flex-shrink: 0;
}

.estrellas-resena {
    color: #F59E0B;
    margin-bottom: 0.25rem;
}

.puntuacion {
    font-size: 0.8rem;
    color: #6B7280;
    font-weight: 600;
}

.resena-item.activa .puntuacion {
    color: white;
}

.resena-comentario p {
    color: #6B7280;
    font-size: 0.9rem;
    line-height: 1.4;
    margin: 0;
}

/* Paginación */
.paginacion-resenas {
    padding: 1rem 1.5rem;
    background: #F8FAFC;
    border-top: 1px solid #E5E7EB;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.info-paginacion {
    font-size: 0.9rem;
    color: #6B7280;
}

.controles-paginacion {
    display: flex;
    gap: 0.5rem;
}

.btn-paginacion {
    width: 40px;
    height: 40px;
    border: 1px solid #E5E7EB;
    background: white;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
    color: #6B7280;
}

.btn-paginacion:hover:not(:disabled) {
    background: #4F46E5;
    color: white;
    border-color: #4F46E5;
}

.btn-paginacion:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Detalle de Reseña */
.contenedor-detalle-resena {
    padding: 1.5rem;
    max-height: 65vh;
    overflow-y: auto;
}

.resena-detalle-completa {
    animation: fadeInUp 0.3s ease;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.resena-detalle-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid #E5E7EB;
}

.resena-info-completa {
    display: flex;
    gap: 1rem;
    align-items: flex-start;
}

.resena-avatar-grande {
    width: 60px;
    height: 60px;
    background: #4F46E5;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
    flex-shrink: 0;
}

.resena-datos h4 {
    color: #1F2937;
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.resena-detalle-meta {
    display: flex;
    gap: 1rem;
    align-items: center;
    flex-wrap: wrap;
}

.fecha-detalle {
    color: #6B7280;
    font-size: 0.9rem;
}

.estado-detalle {
    padding: 0.3rem 0.8rem;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: 500;
}

.estado-respondida {
    background: #D1FAE5;
    color: #065F46;
}

.estado-pendiente {
    background: #FEF3C7;
    color: #92400E;
}

.resena-calificacion-detalle {
    text-align: right;
}

.estrellas-grandes {
    color: #F59E0B;
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
}

.puntuacion-grande {
    font-size: 1.1rem;
    color: #1F2937;
    font-weight: 600;
}

/* Secciones de contenido */
.titulo-seccion {
    color: #374151;
    margin-bottom: 1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
}

.seccion-comentario-cliente,
.seccion-respuesta-existente,
.seccion-formulario-respuesta {
    margin-bottom: 2rem;
}

.comentario-cliente {
    background: #F8FAFC;
    padding: 1.5rem;
    border-radius: 12px;
    border-left: 4px solid #4F46E5;
}

.comentario-cliente p {
    color: #374151;
    line-height: 1.6;
    margin: 0;
}

.respuesta-actual {
    background: #D1FAE5;
    padding: 1.5rem;
    border-radius: 12px;
    border-left: 4px solid #10B981;
}

.respuesta-actual p {
    color: #065F46;
    line-height: 1.6;
    margin: 0;
}

.fecha-respuesta {
    color: #6B7280;
    font-weight: normal;
    font-size: 0.9rem;
}

/* Formulario de Respuesta */
.formulario-respuesta {
    background: #F8FAFC;
    padding: 1.5rem;
    border-radius: 12px;
}

.campo-respuesta {
    position: relative;
    margin-bottom: 1rem;
}

.input-respuesta {
    width: 100%;
    padding: 1rem;
    border: 2px solid #E5E7EB;
    border-radius: 8px;
    font-size: 0.95rem;
    transition: all 0.3s;
    background: white;
    resize: vertical;
    min-height: 120px;
}

.input-respuesta:focus {
    outline: none;
    border-color: #4F46E5;
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}

.contador-caracteres {
    position: absolute;
    bottom: 0.5rem;
    right: 0.5rem;
    font-size: 0.8rem;
    color: #6B7280;
    background: white;
    padding: 0.2rem 0.5rem;
    border-radius: 10px;
}

.acciones-respuesta {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
}

.btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-primario {
    background: var(--secondary-gradient);
    color: white;
}

.btn-primario:hover {
    background: linear-gradient(135deg, #4338CA, #6D28D9);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
}

.btn-secundario {
    background: white;
    color: #6B7280;
    border: 1px solid #E5E7EB;
}

.btn-secundario:hover {
    background: #F3F4F6;
    border-color: #D1D5DB;
}

/* Estados Vacío */
.estado-vacio {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 3rem;
    text-align: center;
    color: #6B7280;
}

.estado-vacio i {
    margin-bottom: 1rem;
    opacity: 0.5;
}

.estado-vacio h4 {
    color: #6B7280;
    margin-bottom: 0.5rem;
}

.estado-vacio p {
    margin-bottom: 0;
}

/* Modal de Exportación */
.formatos-exportacion {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-top: 1rem;
}

.btn-formato {
    padding: 1.5rem;
    border: 2px solid #E5E7EB;
    border-radius: 12px;
    background: white;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
}

.btn-formato:hover {
    border-color: #4F46E5;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.btn-formato i {
    font-size: 2rem;
    color: #4F46E5;
}

.btn-formato span {
    font-weight: 600;
    color: #374151;
}

/* Responsive */
@media (max-width: 1200px) {
    .resena-detalle-header {
        flex-direction: column;
        gap: 1rem;
    }
    
    .resena-calificacion-detalle {
        text-align: left;
    }
}

@media (max-width: 992px) {
    .seccion-lista-resenas,
    .seccion-detalle-resena {
        max-height: none;
    }
    
    .contenedor-lista-resenas,
    .contenedor-detalle-resena {
        max-height: 50vh;
    }
}

@media (max-width: 768px) {
    .estadisticas-grid {
        grid-template-columns: 1fr;
    }
    
    .barra-herramientas {
        flex-direction: column;
        align-items: stretch;
    }
    
    .grupo-botones-accion {
        flex-direction: column;
    }
    
    .boton-accion {
        width: 100%;
        justify-content: center;
    }
    
    .contenedor-busqueda {
        min-width: 100%;
    }
    
    .contenedor-filtros {
        width: 100%;
        justify-content: space-between;
    }
    
    .resena-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
    }
    
    .resena-calificacion {
        text-align: left;
    }
    
    .resena-detalle-header {
        flex-direction: column;
        gap: 1rem;
    }
    
    .resena-info-completa {
        flex-direction: column;
        text-align: center;
    }
    
    .acciones-respuesta {
        flex-direction: column;
    }
    
    .formatos-exportacion {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 576px) {
    .tarjeta-bienvenida {
        padding: 1.5rem;
    }
    
    .seccion-header {
        padding: 1rem;
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
    }
    
    .contenedor-lista-resenas,
    .contenedor-detalle-resena {
        padding: 1rem;
    }
    
    .resena-item {
        padding: 1rem;
    }
    
    .resena-meta {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }
}
</style>
{% endblock %}